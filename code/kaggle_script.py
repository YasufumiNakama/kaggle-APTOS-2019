import base64
import os
import shutil
from pathlib import Path
from typing import Dict


# this is base64 encoded source code
file_data: Dict = {  # RandomCrop(288)
                    'aptos/transforms.py': 'aW1wb3J0IHJhbmRvbQppbXBvcnQgbWF0aAppbXBvcnQgbnVtYmVycwoKZnJvbSBQSUwgaW1wb3J0IEltYWdlCmltcG9ydCB0b3JjaHZpc2lvbi50cmFuc2Zvcm1zLmZ1bmN0aW9uYWwgYXMgRgpmcm9tIHRvcmNodmlzaW9uLnRyYW5zZm9ybXMgaW1wb3J0ICgKICAgIFRvVGVuc29yLCBOb3JtYWxpemUsIENvbXBvc2UsIFJlc2l6ZSwgQ2VudGVyQ3JvcCwgUmFuZG9tQ3JvcCwKICAgIFJhbmRvbUhvcml6b250YWxGbGlwLCBSYW5kb21SZXNpemVkQ3JvcCwgUmFuZG9tUm90YXRpb24pCgoKY2xhc3MgUmFuZG9tU2l6ZWRDcm9wOgogICAgIiIiUmFuZG9tIGNyb3AgdGhlIGdpdmVuIFBJTC5JbWFnZSB0byBhIHJhbmRvbSBzaXplCiAgICBvZiB0aGUgb3JpZ2luYWwgc2l6ZSBhbmQgYW5kIGEgcmFuZG9tIGFzcGVjdCByYXRpbwogICAgb2YgdGhlIG9yaWdpbmFsIGFzcGVjdCByYXRpby4KICAgIHNpemU6IHNpemUgb2YgdGhlIHNtYWxsZXIgZWRnZQogICAgaW50ZXJwb2xhdGlvbjogRGVmYXVsdDogUElMLkltYWdlLkJJTElORUFSCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgc2l6ZSwgaW50ZXJwb2xhdGlvbj1JbWFnZS5CSUxJTkVBUiwKICAgICAgICAgICAgICAgICBtaW5fYXNwZWN0PTQvNSwgbWF4X2FzcGVjdD01LzQsCiAgICAgICAgICAgICAgICAgbWluX2FyZWE9MC4yNSwgbWF4X2FyZWE9MSk6CiAgICAgICAgc2VsZi5zaXplID0gc2l6ZQogICAgICAgIHNlbGYuaW50ZXJwb2xhdGlvbiA9IGludGVycG9sYXRpb24KICAgICAgICBzZWxmLm1pbl9hc3BlY3QgPSBtaW5fYXNwZWN0CiAgICAgICAgc2VsZi5tYXhfYXNwZWN0ID0gbWF4X2FzcGVjdAogICAgICAgIHNlbGYubWluX2FyZWEgPSBtaW5fYXJlYQogICAgICAgIHNlbGYubWF4X2FyZWEgPSBtYXhfYXJlYQoKICAgIGRlZiBfX2NhbGxfXyhzZWxmLCBpbWcpOgogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDEwKToKICAgICAgICAgICAgYXJlYSA9IGltZy5zaXplWzBdICogaW1nLnNpemVbMV0KICAgICAgICAgICAgdGFyZ2V0X2FyZWEgPSByYW5kb20udW5pZm9ybShzZWxmLm1pbl9hcmVhLCBzZWxmLm1heF9hcmVhKSAqIGFyZWEKICAgICAgICAgICAgYXNwZWN0X3JhdGlvID0gcmFuZG9tLnVuaWZvcm0oc2VsZi5taW5fYXNwZWN0LCBzZWxmLm1heF9hc3BlY3QpCgogICAgICAgICAgICB3ID0gaW50KHJvdW5kKG1hdGguc3FydCh0YXJnZXRfYXJlYSAqIGFzcGVjdF9yYXRpbykpKQogICAgICAgICAgICBoID0gaW50KHJvdW5kKG1hdGguc3FydCh0YXJnZXRfYXJlYSAvIGFzcGVjdF9yYXRpbykpKQoKICAgICAgICAgICAgaWYgcmFuZG9tLnJhbmRvbSgpIDwgMC41OgogICAgICAgICAgICAgICAgdywgaCA9IGgsIHcKCiAgICAgICAgICAgIGlmIHcgPD0gaW1nLnNpemVbMF0gYW5kIGggPD0gaW1nLnNpemVbMV06CiAgICAgICAgICAgICAgICB4MSA9IHJhbmRvbS5yYW5kaW50KDAsIGltZy5zaXplWzBdIC0gdykKICAgICAgICAgICAgICAgIHkxID0gcmFuZG9tLnJhbmRpbnQoMCwgaW1nLnNpemVbMV0gLSBoKQoKICAgICAgICAgICAgICAgIGltZyA9IGltZy5jcm9wKCh4MSwgeTEsIHgxICsgdywgeTEgKyBoKSkKICAgICAgICAgICAgICAgIGFzc2VydChpbWcuc2l6ZSA9PSAodywgaCkpCgogICAgICAgICAgICAgICAgcmV0dXJuIGltZy5yZXNpemUoKHNlbGYuc2l6ZSwgc2VsZi5zaXplKSwgc2VsZi5pbnRlcnBvbGF0aW9uKQoKICAgICAgICAjIEZhbGxiYWNrCiAgICAgICAgc2NhbGUgPSBSZXNpemUoc2VsZi5zaXplLCBpbnRlcnBvbGF0aW9uPXNlbGYuaW50ZXJwb2xhdGlvbikKICAgICAgICBjcm9wID0gQ2VudGVyQ3JvcChzZWxmLnNpemUpCiAgICAgICAgcmV0dXJuIGNyb3Aoc2NhbGUoaW1nKSkKCgpjbGFzcyBSYW5kb21Sb3RhdGUob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkZWdyZWVzLCByZXNhbXBsZT1GYWxzZSwgZXhwYW5kPUZhbHNlLCBjZW50ZXI9Tm9uZSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShkZWdyZWVzLCBudW1iZXJzLk51bWJlcik6CiAgICAgICAgICAgIGlmIGRlZ3JlZXMgPCAwOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiSWYgZGVncmVlcyBpcyBhIHNpbmdsZSBudW1iZXIsIGl0IG11c3QgYmUgcG9zaXRpdmUuIikKICAgICAgICAgICAgc2VsZi5kZWdyZWVzID0gKC1kZWdyZWVzLCBkZWdyZWVzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGxlbihkZWdyZWVzKSAhPSAyOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiSWYgZGVncmVlcyBpcyBhIHNlcXVlbmNlLCBpdCBtdXN0IGJlIG9mIGxlbiAyLiIpCiAgICAgICAgICAgIHNlbGYuZGVncmVlcyA9IGRlZ3JlZXMKCiAgICAgICAgc2VsZi5yZXNhbXBsZSA9IHJlc2FtcGxlCiAgICAgICAgc2VsZi5leHBhbmQgPSBleHBhbmQKICAgICAgICBzZWxmLmNlbnRlciA9IGNlbnRlcgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBnZXRfcGFyYW1zKGRlZ3JlZXMpOgogICAgICAgIGFuZ2xlID0gcmFuZG9tLnVuaWZvcm0oZGVncmVlc1swXSwgZGVncmVlc1sxXSkKCiAgICAgICAgcmV0dXJuIGFuZ2xlCgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIGltZyk6CiAgICAgICAgaWYgcmFuZG9tLnJhbmRvbSgpIDwgMC41OgogICAgICAgICAgICBhbmdsZSA9IHNlbGYuZ2V0X3BhcmFtcyhzZWxmLmRlZ3JlZXMpCiAgICAgICAgICAgIHJldHVybiBGLnJvdGF0ZShpbWcsIGFuZ2xlLCBzZWxmLnJlc2FtcGxlLCBzZWxmLmV4cGFuZCwgc2VsZi5jZW50ZXIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYW5nbGUgPSByYW5kb20udW5pZm9ybSgwLCAwKQogICAgICAgICAgICByZXR1cm4gRi5yb3RhdGUoaW1nLCBhbmdsZSwgc2VsZi5yZXNhbXBsZSwgc2VsZi5leHBhbmQsIHNlbGYuY2VudGVyKQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICBmb3JtYXRfc3RyaW5nID0gc2VsZi5fX2NsYXNzX18uX19uYW1lX18gKyAnKGRlZ3JlZXM9ezB9Jy5mb3JtYXQoc2VsZi5kZWdyZWVzKQogICAgICAgIGZvcm1hdF9zdHJpbmcgKz0gJywgcmVzYW1wbGU9ezB9Jy5mb3JtYXQoc2VsZi5yZXNhbXBsZSkKICAgICAgICBmb3JtYXRfc3RyaW5nICs9ICcsIGV4cGFuZD17MH0nLmZvcm1hdChzZWxmLmV4cGFuZCkKICAgICAgICBpZiBzZWxmLmNlbnRlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgZm9ybWF0X3N0cmluZyArPSAnLCBjZW50ZXI9ezB9Jy5mb3JtYXQoc2VsZi5jZW50ZXIpCiAgICAgICAgZm9ybWF0X3N0cmluZyArPSAnKScKICAgICAgICByZXR1cm4gZm9ybWF0X3N0cmluZwoKCnRyYWluX3RyYW5zZm9ybSA9IENvbXBvc2UoWwogICAgIyBSYW5kb21Sb3RhdGUoKDkwLCA5MCksIGV4cGFuZD1UcnVlKSwKICAgIFJhbmRvbUNyb3AoMjg4KSwKICAgIFJhbmRvbUhvcml6b250YWxGbGlwKCksCl0pCgoKdGVzdF90cmFuc2Zvcm0gPSBDb21wb3NlKFsKICAgICMgUmFuZG9tUm90YXRlKCg5MCwgOTApLCBleHBhbmQ9VHJ1ZSksCiAgICBSYW5kb21Dcm9wKDI4OCksCiAgICBSYW5kb21Ib3Jpem9udGFsRmxpcCgpLApdKQoKCiIiIgp0cmFpbl90cmFuc2Zvcm0gPSBDb21wb3NlKFsKICAgICMgUmFuZG9tUm90YXRlKCg5MCwgOTApLCBleHBhbmQ9VHJ1ZSksCiAgICBSYW5kb21SZXNpemVkQ3JvcCgzMjAsIHNjYWxlPSgwLjYsIDEuMCksIHJhdGlvPSg5LzE2LCAxNi85KSksCiAgICBSYW5kb21Ib3Jpem9udGFsRmxpcCgpLApdKQp0ZXN0X3RyYW5zZm9ybSA9IENvbXBvc2UoWwogICAgIyBSYW5kb21Sb3RhdGUoKDkwLCA5MCksIGV4cGFuZD1UcnVlKSwKICAgIFJhbmRvbVJlc2l6ZWRDcm9wKDMyMCwgc2NhbGU9KDAuNiwgMS4wKSwgcmF0aW89KDkvMTYsIDE2LzkpKSwKICAgIFJhbmRvbUhvcml6b250YWxGbGlwKCksCl0pCiIiIgoKCnRlbnNvcl90cmFuc2Zvcm0gPSBDb21wb3NlKFsKICAgIFRvVGVuc29yKCksCiAgICBOb3JtYWxpemUobWVhbj1bMC40ODUsIDAuNDU2LCAwLjQwNl0sIHN0ZD1bMC4yMjksIDAuMjI0LCAwLjIyNV0pLApdKQo=',
                    'aptos/models.py': 'aW1wb3J0IG1hdGgKZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgT3JkZXJlZERpY3QKZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHBhcnRpYWwKCmltcG9ydCB0b3JjaApmcm9tIHRvcmNoIGltcG9ydCBubgpmcm9tIHRvcmNoLm5uIGltcG9ydCBmdW5jdGlvbmFsIGFzIEYKaW1wb3J0IHRvcmNodmlzaW9uLm1vZGVscyBhcyBNCgpmcm9tIGZhc3RhaS5sYXllcnMgaW1wb3J0IEFkYXB0aXZlQ29uY2F0UG9vbDJkCgpmcm9tIC51dGlscyBpbXBvcnQgT05fS0FHR0xFCgoiIiIKV2hlbiB5b3UgdXNlIEFkYXB0aXZlQ29uY2F0UG9vbDJkOgooQmVmb3JlKQogICAgc2VsZi5uZXQuYXZnX3Bvb2wgPSBBdmdQb29sKCkKICAgIHNlbGYubmV0Lmxhc3RfbGluZWFyID0gbm4uTGluZWFyKHNlbGYubmV0Lmxhc3RfbGluZWFyLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKKEFmdGVyKQogICAgc2VsZi5uZXQuYXZnX3Bvb2wgPSBBZGFwdGl2ZUNvbmNhdFBvb2wyZCgxKQogICAgc2VsZi5uZXQubGFzdF9saW5lYXIgPSBubi5MaW5lYXIoc2VsZi5uZXQubGFzdF9saW5lYXIuaW5fZmVhdHVyZXMgKiAyLCBudW1fY2xhc3NlcykKCldoZW4geW91IHRyeSAybmQtdHJhaW46Cm9zLm1ha2VkaXJzKCcuLi9pbnB1dC9zZV9yZXNuZXh0NTBfMzJ4NGQnKQojIDFzdC10cmFpbiBscj0xZS00CiMgc2h1dGlsLmNvcHkoJy4uL2lucHV0L3B5dG9yY2gtcHJldHJhaW5lZC1zZXJlc25ldC9zZV9yZXNuZXh0NTBfMzJ4NGQtYTI2MGIzYTQucHRoJywgJy4uL2lucHV0L3NlX3Jlc25leHQ1MF8zMng0ZC9zZV9yZXNuZXh0NTBfMzJ4NGQucHRoJykKIyAybmQtdHJhaW4gJiBhZGp1c3QgbHI9MWUtNQpzaHV0aWwuY29weSgnLi4vaW5wdXQvaW1ldC13ZWlnaHRzL1NFUmVzTmVYdDUwXzMyeDRkX1JhbmRvbVJvdGF0ZV8xc3RfdjQyLnB0JywgJy4uL2lucHV0L3NlX3Jlc25leHQ1MF8zMng0ZC9zZV9yZXNuZXh0NTBfMzJ4NGQucHRoJykKY2xhc3MgU0VSZXNOZVh0NTBfMzJ4NGQobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1fY2xhc3NlcywgcHJldHJhaW5lZD1GYWxzZSwgZHJvcG91dD1GYWxzZSwgbmV0X2Nscz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IFNFTmV0KFNFUmVzTmVYdEJvdHRsZW5lY2ssIFszLDQsNiwzXSwgZ3JvdXBzPTMyLCByZWR1Y3Rpb249MTYsCiAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wb3V0X3A9Tm9uZSwgaW5wbGFuZXM9NjQsIGlucHV0XzN4Mz1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemU9MSwgZG93bnNhbXBsZV9wYWRkaW5nPTAsCiAgICAgICAgICAgICAgICAgICAgICAgICBudW1fY2xhc3Nlcz0xMDAwKQogICAgICAgIHdlaWdodHNfcGF0aCA9IGYnLi4vaW5wdXQvc2VfcmVzbmV4dDUwXzMyeDRkL3NlX3Jlc25leHQ1MF8zMng0ZC5wdGgnCiAgICAgICAgI3NlbGYubmV0LmxvYWRfc3RhdGVfZGljdCh0b3JjaC5sb2FkKHdlaWdodHNfcGF0aCkpCiAgICAgICAgc2VsZi5uZXQuYXZnX3Bvb2wgPSBBdmdQb29sKCkKICAgICAgICBzZWxmLm5ldC5sYXN0X2xpbmVhciA9IG5uLkxpbmVhcihzZWxmLm5ldC5sYXN0X2xpbmVhci5pbl9mZWF0dXJlcywgbnVtX2NsYXNzZXMpCiAgICAgICAgc2VsZi5sb2FkX3N0YXRlX2RpY3QodG9yY2gubG9hZCh3ZWlnaHRzX3BhdGgpWydtb2RlbCddKQogICAgZGVmIGZyZXNoX3BhcmFtcyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5uZXQubGFzdF9saW5lYXIucGFyYW1ldGVycygpCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5uZXQoeCkKIiIiCgoKY2xhc3MgU0VNb2R1bGUobm4uTW9kdWxlKToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgY2hhbm5lbHMsIHJlZHVjdGlvbik6CiAgICAgICAgc3VwZXIoU0VNb2R1bGUsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmF2Z19wb29sID0gbm4uQWRhcHRpdmVBdmdQb29sMmQoMSkKICAgICAgICBzZWxmLmZjMSA9IG5uLkNvbnYyZChjaGFubmVscywgY2hhbm5lbHMgLy8gcmVkdWN0aW9uLCBrZXJuZWxfc2l6ZT0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc9MCkKICAgICAgICBzZWxmLnJlbHUgPSBubi5SZUxVKGlucGxhY2U9VHJ1ZSkKICAgICAgICBzZWxmLmZjMiA9IG5uLkNvbnYyZChjaGFubmVscyAvLyByZWR1Y3Rpb24sIGNoYW5uZWxzLCBrZXJuZWxfc2l6ZT0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc9MCkKICAgICAgICBzZWxmLnNpZ21vaWQgPSBubi5TaWdtb2lkKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICBtb2R1bGVfaW5wdXQgPSB4CiAgICAgICAgeCA9IHNlbGYuYXZnX3Bvb2woeCkKICAgICAgICB4ID0gc2VsZi5mYzEoeCkKICAgICAgICB4ID0gc2VsZi5yZWx1KHgpCiAgICAgICAgeCA9IHNlbGYuZmMyKHgpCiAgICAgICAgeCA9IHNlbGYuc2lnbW9pZCh4KQogICAgICAgIHJldHVybiBtb2R1bGVfaW5wdXQgKiB4CgoKY2xhc3MgQm90dGxlbmVjayhubi5Nb2R1bGUpOgogICAgIiIiCiAgICBCYXNlIGNsYXNzIGZvciBib3R0bGVuZWNrcyB0aGF0IGltcGxlbWVudHMgYGZvcndhcmQoKWAgbWV0aG9kLgogICAgIiIiCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgcmVzaWR1YWwgPSB4CgogICAgICAgIG91dCA9IHNlbGYuY29udjEoeCkKICAgICAgICBvdXQgPSBzZWxmLmJuMShvdXQpCiAgICAgICAgb3V0ID0gc2VsZi5yZWx1KG91dCkKCiAgICAgICAgb3V0ID0gc2VsZi5jb252MihvdXQpCiAgICAgICAgb3V0ID0gc2VsZi5ibjIob3V0KQogICAgICAgIG91dCA9IHNlbGYucmVsdShvdXQpCgogICAgICAgIG91dCA9IHNlbGYuY29udjMob3V0KQogICAgICAgIG91dCA9IHNlbGYuYm4zKG91dCkKCiAgICAgICAgaWYgc2VsZi5kb3duc2FtcGxlIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXNpZHVhbCA9IHNlbGYuZG93bnNhbXBsZSh4KQoKICAgICAgICBvdXQgPSBzZWxmLnNlX21vZHVsZShvdXQpICsgcmVzaWR1YWwKICAgICAgICBvdXQgPSBzZWxmLnJlbHUob3V0KQoKICAgICAgICByZXR1cm4gb3V0CgoKY2xhc3MgU0VCb3R0bGVuZWNrKEJvdHRsZW5lY2spOgogICAgIiIiCiAgICBCb3R0bGVuZWNrIGZvciBTRU5ldDE1NC4KICAgICIiIgogICAgZXhwYW5zaW9uID0gNAoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBpbnBsYW5lcywgcGxhbmVzLCBncm91cHMsIHJlZHVjdGlvbiwgc3RyaWRlPTEsCiAgICAgICAgICAgICAgICAgZG93bnNhbXBsZT1Ob25lKToKICAgICAgICBzdXBlcihTRUJvdHRsZW5lY2ssIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmNvbnYxID0gbm4uQ29udjJkKGlucGxhbmVzLCBwbGFuZXMgKiAyLCBrZXJuZWxfc2l6ZT0xLCBiaWFzPUZhbHNlKQogICAgICAgIHNlbGYuYm4xID0gbm4uQmF0Y2hOb3JtMmQocGxhbmVzICogMikKICAgICAgICBzZWxmLmNvbnYyID0gbm4uQ29udjJkKHBsYW5lcyAqIDIsIHBsYW5lcyAqIDQsIGtlcm5lbF9zaXplPTMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpZGU9c3RyaWRlLCBwYWRkaW5nPTEsIGdyb3Vwcz1ncm91cHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaWFzPUZhbHNlKQogICAgICAgIHNlbGYuYm4yID0gbm4uQmF0Y2hOb3JtMmQocGxhbmVzICogNCkKICAgICAgICBzZWxmLmNvbnYzID0gbm4uQ29udjJkKHBsYW5lcyAqIDQsIHBsYW5lcyAqIDQsIGtlcm5lbF9zaXplPTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaWFzPUZhbHNlKQogICAgICAgIHNlbGYuYm4zID0gbm4uQmF0Y2hOb3JtMmQocGxhbmVzICogNCkKICAgICAgICBzZWxmLnJlbHUgPSBubi5SZUxVKGlucGxhY2U9VHJ1ZSkKICAgICAgICBzZWxmLnNlX21vZHVsZSA9IFNFTW9kdWxlKHBsYW5lcyAqIDQsIHJlZHVjdGlvbj1yZWR1Y3Rpb24pCiAgICAgICAgc2VsZi5kb3duc2FtcGxlID0gZG93bnNhbXBsZQogICAgICAgIHNlbGYuc3RyaWRlID0gc3RyaWRlCgoKY2xhc3MgU0VSZXNOZXRCb3R0bGVuZWNrKEJvdHRsZW5lY2spOgogICAgIiIiCiAgICBSZXNOZXQgYm90dGxlbmVjayB3aXRoIGEgU3F1ZWV6ZS1hbmQtRXhjaXRhdGlvbiBtb2R1bGUuIEl0IGZvbGxvd3MgQ2FmZmUKICAgIGltcGxlbWVudGF0aW9uIGFuZCB1c2VzIGBzdHJpZGU9c3RyaWRlYCBpbiBgY29udjFgIGFuZCBub3QgaW4gYGNvbnYyYAogICAgKHRoZSBsYXR0ZXIgaXMgdXNlZCBpbiB0aGUgdG9yY2h2aXNpb24gaW1wbGVtZW50YXRpb24gb2YgUmVzTmV0KS4KICAgICIiIgogICAgZXhwYW5zaW9uID0gNAoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBpbnBsYW5lcywgcGxhbmVzLCBncm91cHMsIHJlZHVjdGlvbiwgc3RyaWRlPTEsCiAgICAgICAgICAgICAgICAgZG93bnNhbXBsZT1Ob25lKToKICAgICAgICBzdXBlcihTRVJlc05ldEJvdHRsZW5lY2ssIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmNvbnYxID0gbm4uQ29udjJkKGlucGxhbmVzLCBwbGFuZXMsIGtlcm5lbF9zaXplPTEsIGJpYXM9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpZGU9c3RyaWRlKQogICAgICAgIHNlbGYuYm4xID0gbm4uQmF0Y2hOb3JtMmQocGxhbmVzKQogICAgICAgIHNlbGYuY29udjIgPSBubi5Db252MmQocGxhbmVzLCBwbGFuZXMsIGtlcm5lbF9zaXplPTMsIHBhZGRpbmc9MSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3Vwcz1ncm91cHMsIGJpYXM9RmFsc2UpCiAgICAgICAgc2VsZi5ibjIgPSBubi5CYXRjaE5vcm0yZChwbGFuZXMpCiAgICAgICAgc2VsZi5jb252MyA9IG5uLkNvbnYyZChwbGFuZXMsIHBsYW5lcyAqIDQsIGtlcm5lbF9zaXplPTEsIGJpYXM9RmFsc2UpCiAgICAgICAgc2VsZi5ibjMgPSBubi5CYXRjaE5vcm0yZChwbGFuZXMgKiA0KQogICAgICAgIHNlbGYucmVsdSA9IG5uLlJlTFUoaW5wbGFjZT1UcnVlKQogICAgICAgIHNlbGYuc2VfbW9kdWxlID0gU0VNb2R1bGUocGxhbmVzICogNCwgcmVkdWN0aW9uPXJlZHVjdGlvbikKICAgICAgICBzZWxmLmRvd25zYW1wbGUgPSBkb3duc2FtcGxlCiAgICAgICAgc2VsZi5zdHJpZGUgPSBzdHJpZGUKCgpjbGFzcyBTRVJlc05lWHRCb3R0bGVuZWNrKEJvdHRsZW5lY2spOgogICAgIiIiCiAgICBSZXNOZVh0IGJvdHRsZW5lY2sgdHlwZSBDIHdpdGggYSBTcXVlZXplLWFuZC1FeGNpdGF0aW9uIG1vZHVsZS4KICAgICIiIgogICAgZXhwYW5zaW9uID0gNAoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBpbnBsYW5lcywgcGxhbmVzLCBncm91cHMsIHJlZHVjdGlvbiwgc3RyaWRlPTEsCiAgICAgICAgICAgICAgICAgZG93bnNhbXBsZT1Ob25lLCBiYXNlX3dpZHRoPTQpOgogICAgICAgIHN1cGVyKFNFUmVzTmVYdEJvdHRsZW5lY2ssIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICB3aWR0aCA9IG1hdGguZmxvb3IocGxhbmVzICogKGJhc2Vfd2lkdGggLyA2NCkpICogZ3JvdXBzCiAgICAgICAgc2VsZi5jb252MSA9IG5uLkNvbnYyZChpbnBsYW5lcywgd2lkdGgsIGtlcm5lbF9zaXplPTEsIGJpYXM9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpZGU9MSkKICAgICAgICBzZWxmLmJuMSA9IG5uLkJhdGNoTm9ybTJkKHdpZHRoKQogICAgICAgIHNlbGYuY29udjIgPSBubi5Db252MmQod2lkdGgsIHdpZHRoLCBrZXJuZWxfc2l6ZT0zLCBzdHJpZGU9c3RyaWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZz0xLCBncm91cHM9Z3JvdXBzLCBiaWFzPUZhbHNlKQogICAgICAgIHNlbGYuYm4yID0gbm4uQmF0Y2hOb3JtMmQod2lkdGgpCiAgICAgICAgc2VsZi5jb252MyA9IG5uLkNvbnYyZCh3aWR0aCwgcGxhbmVzICogNCwga2VybmVsX3NpemU9MSwgYmlhcz1GYWxzZSkKICAgICAgICBzZWxmLmJuMyA9IG5uLkJhdGNoTm9ybTJkKHBsYW5lcyAqIDQpCiAgICAgICAgc2VsZi5yZWx1ID0gbm4uUmVMVShpbnBsYWNlPVRydWUpCiAgICAgICAgc2VsZi5zZV9tb2R1bGUgPSBTRU1vZHVsZShwbGFuZXMgKiA0LCByZWR1Y3Rpb249cmVkdWN0aW9uKQogICAgICAgIHNlbGYuZG93bnNhbXBsZSA9IGRvd25zYW1wbGUKICAgICAgICBzZWxmLnN0cmlkZSA9IHN0cmlkZQoKCmNsYXNzIFNFTmV0KG5uLk1vZHVsZSk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJsb2NrLCBsYXllcnMsIGdyb3VwcywgcmVkdWN0aW9uLCBkcm9wb3V0X3A9MC4yLAogICAgICAgICAgICAgICAgIGlucGxhbmVzPTEyOCwgaW5wdXRfM3gzPVRydWUsIGRvd25zYW1wbGVfa2VybmVsX3NpemU9MywKICAgICAgICAgICAgICAgICBkb3duc2FtcGxlX3BhZGRpbmc9MSwgbnVtX2NsYXNzZXM9MTAwMCk6CiAgICAgICAgIiIiCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0KICAgICAgICBibG9jayAobm4uTW9kdWxlKTogQm90dGxlbmVjayBjbGFzcy4KICAgICAgICAgICAgLSBGb3IgU0VOZXQxNTQ6IFNFQm90dGxlbmVjawogICAgICAgICAgICAtIEZvciBTRS1SZXNOZXQgbW9kZWxzOiBTRVJlc05ldEJvdHRsZW5lY2sKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmVYdCBtb2RlbHM6ICBTRVJlc05lWHRCb3R0bGVuZWNrCiAgICAgICAgbGF5ZXJzIChsaXN0IG9mIGludHMpOiBOdW1iZXIgb2YgcmVzaWR1YWwgYmxvY2tzIGZvciA0IGxheWVycyBvZiB0aGUKICAgICAgICAgICAgbmV0d29yayAobGF5ZXIxLi4ubGF5ZXI0KS4KICAgICAgICBncm91cHMgKGludCk6IE51bWJlciBvZiBncm91cHMgZm9yIHRoZSAzeDMgY29udm9sdXRpb24gaW4gZWFjaAogICAgICAgICAgICBib3R0bGVuZWNrIGJsb2NrLgogICAgICAgICAgICAtIEZvciBTRU5ldDE1NDogNjQKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmV0IG1vZGVsczogMQogICAgICAgICAgICAtIEZvciBTRS1SZXNOZVh0IG1vZGVsczogIDMyCiAgICAgICAgcmVkdWN0aW9uIChpbnQpOiBSZWR1Y3Rpb24gcmF0aW8gZm9yIFNxdWVlemUtYW5kLUV4Y2l0YXRpb24gbW9kdWxlcy4KICAgICAgICAgICAgLSBGb3IgYWxsIG1vZGVsczogMTYKICAgICAgICBkcm9wb3V0X3AgKGZsb2F0IG9yIE5vbmUpOiBEcm9wIHByb2JhYmlsaXR5IGZvciB0aGUgRHJvcG91dCBsYXllci4KICAgICAgICAgICAgSWYgYE5vbmVgIHRoZSBEcm9wb3V0IGxheWVyIGlzIG5vdCB1c2VkLgogICAgICAgICAgICAtIEZvciBTRU5ldDE1NDogMC4yCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05ldCBtb2RlbHM6IE5vbmUKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmVYdCBtb2RlbHM6IE5vbmUKICAgICAgICBpbnBsYW5lcyAoaW50KTogIE51bWJlciBvZiBpbnB1dCBjaGFubmVscyBmb3IgbGF5ZXIxLgogICAgICAgICAgICAtIEZvciBTRU5ldDE1NDogMTI4CiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05ldCBtb2RlbHM6IDY0CiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05lWHQgbW9kZWxzOiA2NAogICAgICAgIGlucHV0XzN4MyAoYm9vbCk6IElmIGBUcnVlYCwgdXNlIHRocmVlIDN4MyBjb252b2x1dGlvbnMgaW5zdGVhZCBvZgogICAgICAgICAgICBhIHNpbmdsZSA3eDcgY29udm9sdXRpb24gaW4gbGF5ZXIwLgogICAgICAgICAgICAtIEZvciBTRU5ldDE1NDogVHJ1ZQogICAgICAgICAgICAtIEZvciBTRS1SZXNOZXQgbW9kZWxzOiBGYWxzZQogICAgICAgICAgICAtIEZvciBTRS1SZXNOZVh0IG1vZGVsczogRmFsc2UKICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplIChpbnQpOiBLZXJuZWwgc2l6ZSBmb3IgZG93bnNhbXBsaW5nIGNvbnZvbHV0aW9ucwogICAgICAgICAgICBpbiBsYXllcjIsIGxheWVyMyBhbmQgbGF5ZXI0LgogICAgICAgICAgICAtIEZvciBTRU5ldDE1NDogMwogICAgICAgICAgICAtIEZvciBTRS1SZXNOZXQgbW9kZWxzOiAxCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05lWHQgbW9kZWxzOiAxCiAgICAgICAgZG93bnNhbXBsZV9wYWRkaW5nIChpbnQpOiBQYWRkaW5nIGZvciBkb3duc2FtcGxpbmcgY29udm9sdXRpb25zIGluCiAgICAgICAgICAgIGxheWVyMiwgbGF5ZXIzIGFuZCBsYXllcjQuCiAgICAgICAgICAgIC0gRm9yIFNFTmV0MTU0OiAxCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05ldCBtb2RlbHM6IDAKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmVYdCBtb2RlbHM6IDAKICAgICAgICBudW1fY2xhc3NlcyAoaW50KTogTnVtYmVyIG9mIG91dHB1dHMgaW4gYGxhc3RfbGluZWFyYCBsYXllci4KICAgICAgICAgICAgLSBGb3IgYWxsIG1vZGVsczogMTAwMAogICAgICAgICIiIgogICAgICAgIHN1cGVyKFNFTmV0LCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5pbnBsYW5lcyA9IGlucGxhbmVzCiAgICAgICAgaWYgaW5wdXRfM3gzOgogICAgICAgICAgICBsYXllcjBfbW9kdWxlcyA9IFsKICAgICAgICAgICAgICAgICgnY29udjEnLCBubi5Db252MmQoMywgNjQsIDMsIHN0cmlkZT0yLCBwYWRkaW5nPTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpYXM9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnYm4xJywgbm4uQmF0Y2hOb3JtMmQoNjQpKSwKICAgICAgICAgICAgICAgICgncmVsdTEnLCBubi5SZUxVKGlucGxhY2U9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjb252MicsIG5uLkNvbnYyZCg2NCwgNjQsIDMsIHN0cmlkZT0xLCBwYWRkaW5nPTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpYXM9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnYm4yJywgbm4uQmF0Y2hOb3JtMmQoNjQpKSwKICAgICAgICAgICAgICAgICgncmVsdTInLCBubi5SZUxVKGlucGxhY2U9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjb252MycsIG5uLkNvbnYyZCg2NCwgaW5wbGFuZXMsIDMsIHN0cmlkZT0xLCBwYWRkaW5nPTEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpYXM9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnYm4zJywgbm4uQmF0Y2hOb3JtMmQoaW5wbGFuZXMpKSwKICAgICAgICAgICAgICAgICgncmVsdTMnLCBubi5SZUxVKGlucGxhY2U9VHJ1ZSkpLAogICAgICAgICAgICBdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGF5ZXIwX21vZHVsZXMgPSBbCiAgICAgICAgICAgICAgICAoJ2NvbnYxJywgbm4uQ29udjJkKDMsIGlucGxhbmVzLCBrZXJuZWxfc2l6ZT03LCBzdHJpZGU9MiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZz0zLCBiaWFzPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ2JuMScsIG5uLkJhdGNoTm9ybTJkKGlucGxhbmVzKSksCiAgICAgICAgICAgICAgICAoJ3JlbHUxJywgbm4uUmVMVShpbnBsYWNlPVRydWUpKSwKICAgICAgICAgICAgXQogICAgICAgICMgVG8gcHJlc2VydmUgY29tcGF0aWJpbGl0eSB3aXRoIENhZmZlIHdlaWdodHMgYGNlaWxfbW9kZT1UcnVlYAogICAgICAgICMgaXMgdXNlZCBpbnN0ZWFkIG9mIGBwYWRkaW5nPTFgLgogICAgICAgIGxheWVyMF9tb2R1bGVzLmFwcGVuZCgoJ3Bvb2wnLCBubi5NYXhQb29sMmQoMywgc3RyaWRlPTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWlsX21vZGU9VHJ1ZSkpKQogICAgICAgIHNlbGYubGF5ZXIwID0gbm4uU2VxdWVudGlhbChPcmRlcmVkRGljdChsYXllcjBfbW9kdWxlcykpCiAgICAgICAgc2VsZi5sYXllcjEgPSBzZWxmLl9tYWtlX2xheWVyKAogICAgICAgICAgICBibG9jaywKICAgICAgICAgICAgcGxhbmVzPTY0LAogICAgICAgICAgICBibG9ja3M9bGF5ZXJzWzBdLAogICAgICAgICAgICBncm91cHM9Z3JvdXBzLAogICAgICAgICAgICByZWR1Y3Rpb249cmVkdWN0aW9uLAogICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPTEsCiAgICAgICAgICAgIGRvd25zYW1wbGVfcGFkZGluZz0wCiAgICAgICAgKQogICAgICAgIHNlbGYubGF5ZXIyID0gc2VsZi5fbWFrZV9sYXllcigKICAgICAgICAgICAgYmxvY2ssCiAgICAgICAgICAgIHBsYW5lcz0xMjgsCiAgICAgICAgICAgIGJsb2Nrcz1sYXllcnNbMV0sCiAgICAgICAgICAgIHN0cmlkZT0yLAogICAgICAgICAgICBncm91cHM9Z3JvdXBzLAogICAgICAgICAgICByZWR1Y3Rpb249cmVkdWN0aW9uLAogICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPWRvd25zYW1wbGVfa2VybmVsX3NpemUsCiAgICAgICAgICAgIGRvd25zYW1wbGVfcGFkZGluZz1kb3duc2FtcGxlX3BhZGRpbmcKICAgICAgICApCiAgICAgICAgc2VsZi5sYXllcjMgPSBzZWxmLl9tYWtlX2xheWVyKAogICAgICAgICAgICBibG9jaywKICAgICAgICAgICAgcGxhbmVzPTI1NiwKICAgICAgICAgICAgYmxvY2tzPWxheWVyc1syXSwKICAgICAgICAgICAgc3RyaWRlPTIsCiAgICAgICAgICAgIGdyb3Vwcz1ncm91cHMsCiAgICAgICAgICAgIHJlZHVjdGlvbj1yZWR1Y3Rpb24sCiAgICAgICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemU9ZG93bnNhbXBsZV9rZXJuZWxfc2l6ZSwKICAgICAgICAgICAgZG93bnNhbXBsZV9wYWRkaW5nPWRvd25zYW1wbGVfcGFkZGluZwogICAgICAgICkKICAgICAgICBzZWxmLmxheWVyNCA9IHNlbGYuX21ha2VfbGF5ZXIoCiAgICAgICAgICAgIGJsb2NrLAogICAgICAgICAgICBwbGFuZXM9NTEyLAogICAgICAgICAgICBibG9ja3M9bGF5ZXJzWzNdLAogICAgICAgICAgICBzdHJpZGU9MiwKICAgICAgICAgICAgZ3JvdXBzPWdyb3VwcywKICAgICAgICAgICAgcmVkdWN0aW9uPXJlZHVjdGlvbiwKICAgICAgICAgICAgZG93bnNhbXBsZV9rZXJuZWxfc2l6ZT1kb3duc2FtcGxlX2tlcm5lbF9zaXplLAogICAgICAgICAgICBkb3duc2FtcGxlX3BhZGRpbmc9ZG93bnNhbXBsZV9wYWRkaW5nCiAgICAgICAgKQogICAgICAgIHNlbGYuYXZnX3Bvb2wgPSBubi5BdmdQb29sMmQoNywgc3RyaWRlPTEpCiAgICAgICAgc2VsZi5kcm9wb3V0ID0gbm4uRHJvcG91dChkcm9wb3V0X3ApIGlmIGRyb3BvdXRfcCBpcyBub3QgTm9uZSBlbHNlIE5vbmUKICAgICAgICBzZWxmLmxhc3RfbGluZWFyID0gbm4uTGluZWFyKDUxMiAqIGJsb2NrLmV4cGFuc2lvbiwgbnVtX2NsYXNzZXMpCgogICAgZGVmIF9tYWtlX2xheWVyKHNlbGYsIGJsb2NrLCBwbGFuZXMsIGJsb2NrcywgZ3JvdXBzLCByZWR1Y3Rpb24sIHN0cmlkZT0xLAogICAgICAgICAgICAgICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemU9MSwgZG93bnNhbXBsZV9wYWRkaW5nPTApOgogICAgICAgIGRvd25zYW1wbGUgPSBOb25lCiAgICAgICAgaWYgc3RyaWRlICE9IDEgb3Igc2VsZi5pbnBsYW5lcyAhPSBwbGFuZXMgKiBibG9jay5leHBhbnNpb246CiAgICAgICAgICAgIGRvd25zYW1wbGUgPSBubi5TZXF1ZW50aWFsKAogICAgICAgICAgICAgICAgbm4uQ29udjJkKHNlbGYuaW5wbGFuZXMsIHBsYW5lcyAqIGJsb2NrLmV4cGFuc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBrZXJuZWxfc2l6ZT1kb3duc2FtcGxlX2tlcm5lbF9zaXplLCBzdHJpZGU9c3RyaWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc9ZG93bnNhbXBsZV9wYWRkaW5nLCBiaWFzPUZhbHNlKSwKICAgICAgICAgICAgICAgIG5uLkJhdGNoTm9ybTJkKHBsYW5lcyAqIGJsb2NrLmV4cGFuc2lvbiksCiAgICAgICAgICAgICkKCiAgICAgICAgbGF5ZXJzID0gW10KICAgICAgICBsYXllcnMuYXBwZW5kKGJsb2NrKHNlbGYuaW5wbGFuZXMsIHBsYW5lcywgZ3JvdXBzLCByZWR1Y3Rpb24sIHN0cmlkZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25zYW1wbGUpKQogICAgICAgIHNlbGYuaW5wbGFuZXMgPSBwbGFuZXMgKiBibG9jay5leHBhbnNpb24KICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCBibG9ja3MpOgogICAgICAgICAgICBsYXllcnMuYXBwZW5kKGJsb2NrKHNlbGYuaW5wbGFuZXMsIHBsYW5lcywgZ3JvdXBzLCByZWR1Y3Rpb24pKQoKICAgICAgICByZXR1cm4gbm4uU2VxdWVudGlhbCgqbGF5ZXJzKQoKICAgIGRlZiBmZWF0dXJlcyhzZWxmLCB4KToKICAgICAgICB4ID0gc2VsZi5sYXllcjAoeCkKICAgICAgICB4ID0gc2VsZi5sYXllcjEoeCkKICAgICAgICB4ID0gc2VsZi5sYXllcjIoeCkKICAgICAgICB4ID0gc2VsZi5sYXllcjMoeCkKICAgICAgICB4ID0gc2VsZi5sYXllcjQoeCkKICAgICAgICByZXR1cm4geAoKICAgIGRlZiBsb2dpdHMoc2VsZiwgeCk6CiAgICAgICAgeCA9IHNlbGYuYXZnX3Bvb2woeCkKICAgICAgICBpZiBzZWxmLmRyb3BvdXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHggPSBzZWxmLmRyb3BvdXQoeCkKICAgICAgICB4ID0geC52aWV3KHguc2l6ZSgwKSwgLTEpCiAgICAgICAgeCA9IHNlbGYubGFzdF9saW5lYXIoeCkKICAgICAgICByZXR1cm4geAoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHggPSBzZWxmLmZlYXR1cmVzKHgpCiAgICAgICAgeCA9IHNlbGYubG9naXRzKHgpCiAgICAgICAgcmV0dXJuIHgKCgpjbGFzcyBTRVJlc05ldDUwKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbnVtX2NsYXNzZXMsIHByZXRyYWluZWQ9RmFsc2UsIGRyb3BvdXQ9RmFsc2UsIG5ldF9jbHM9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5uZXQgPSBTRU5ldChTRVJlc05ldEJvdHRsZW5lY2ssIFszLCA0LCA2LCAzXSwgZ3JvdXBzPTEsIHJlZHVjdGlvbj0xNiwKICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BvdXRfcD1Ob25lLCBpbnBsYW5lcz02NCwgaW5wdXRfM3gzPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgZG93bnNhbXBsZV9rZXJuZWxfc2l6ZT0xLCBkb3duc2FtcGxlX3BhZGRpbmc9MCwKICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9jbGFzc2VzPTEwMDApCiAgICAgICAgd2VpZ2h0c19wYXRoID0gZicuLi9pbnB1dC9zZV9yZXNuZXQ1MC9zZV9yZXNuZXQ1MC5wdGgnCiAgICAgICAgc2VsZi5uZXQubG9hZF9zdGF0ZV9kaWN0KHRvcmNoLmxvYWQod2VpZ2h0c19wYXRoKSkKICAgICAgICBzZWxmLm5ldC5hdmdfcG9vbCA9IEF2Z1Bvb2woKQogICAgICAgIHNlbGYubmV0Lmxhc3RfbGluZWFyID0gbm4uTGluZWFyKHNlbGYubmV0Lmxhc3RfbGluZWFyLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKCiAgICBkZWYgZnJlc2hfcGFyYW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLm5ldC5sYXN0X2xpbmVhci5wYXJhbWV0ZXJzKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5uZXQoeCkKCgpjbGFzcyBTRVJlc05ldDEwMShubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG51bV9jbGFzc2VzLCBwcmV0cmFpbmVkPUZhbHNlLCBkcm9wb3V0PUZhbHNlLCBuZXRfY2xzPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQogICAgICAgIHNlbGYubmV0ID0gU0VOZXQoU0VSZXNOZXRCb3R0bGVuZWNrLCBbMywgNCwgMjMsIDNdLCBncm91cHM9MSwgcmVkdWN0aW9uPTE2LAogICAgICAgICAgICAgICAgICAgICAgICAgZHJvcG91dF9wPU5vbmUsIGlucGxhbmVzPTY0LCBpbnB1dF8zeDM9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPTEsIGRvd25zYW1wbGVfcGFkZGluZz0wLAogICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NsYXNzZXM9MTAwMCkKICAgICAgICB3ZWlnaHRzX3BhdGggPSBmJy4uL2lucHV0L3NlX3Jlc25ldDEwMS9zZV9yZXNuZXQxMDEucHRoJwogICAgICAgIHNlbGYubmV0LmxvYWRfc3RhdGVfZGljdCh0b3JjaC5sb2FkKHdlaWdodHNfcGF0aCkpCiAgICAgICAgc2VsZi5uZXQuYXZnX3Bvb2wgPSBBdmdQb29sKCkKICAgICAgICBzZWxmLm5ldC5sYXN0X2xpbmVhciA9IG5uLkxpbmVhcihzZWxmLm5ldC5sYXN0X2xpbmVhci5pbl9mZWF0dXJlcywgbnVtX2NsYXNzZXMpCgogICAgZGVmIGZyZXNoX3BhcmFtcyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5uZXQubGFzdF9saW5lYXIucGFyYW1ldGVycygpCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0KHgpCgoKY2xhc3MgU0VSZXNOZXQxNTIobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1fY2xhc3NlcywgcHJldHJhaW5lZD1GYWxzZSwgZHJvcG91dD1GYWxzZSwgbmV0X2Nscz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IFNFTmV0KFNFUmVzTmV0Qm90dGxlbmVjaywgWzMsIDgsIDM2LCAzXSwgZ3JvdXBzPTEsIHJlZHVjdGlvbj0xNiwKICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BvdXRfcD1Ob25lLCBpbnBsYW5lcz02NCwgaW5wdXRfM3gzPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgZG93bnNhbXBsZV9rZXJuZWxfc2l6ZT0xLCBkb3duc2FtcGxlX3BhZGRpbmc9MCwKICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9jbGFzc2VzPTEwMDApCiAgICAgICAgd2VpZ2h0c19wYXRoID0gZicuLi9pbnB1dC9zZV9yZXNuZXQxNTIvc2VfcmVzbmV0MTUyLnB0aCcKICAgICAgICBzZWxmLm5ldC5sb2FkX3N0YXRlX2RpY3QodG9yY2gubG9hZCh3ZWlnaHRzX3BhdGgpKQogICAgICAgIHNlbGYubmV0LmF2Z19wb29sID0gQXZnUG9vbCgpCiAgICAgICAgc2VsZi5uZXQubGFzdF9saW5lYXIgPSBubi5MaW5lYXIoc2VsZi5uZXQubGFzdF9saW5lYXIuaW5fZmVhdHVyZXMsIG51bV9jbGFzc2VzKQoKICAgIGRlZiBmcmVzaF9wYXJhbXMoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0Lmxhc3RfbGluZWFyLnBhcmFtZXRlcnMoKQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHJldHVybiBzZWxmLm5ldCh4KQoKCmNsYXNzIFNFUmVzTmVYdDUwXzMyeDRkKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbnVtX2NsYXNzZXMsIHByZXRyYWluZWQ9RmFsc2UsIGRyb3BvdXQ9RmFsc2UsIG5ldF9jbHM9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5uZXQgPSBTRU5ldChTRVJlc05lWHRCb3R0bGVuZWNrLCBbMywgNCwgNiwgM10sIGdyb3Vwcz0zMiwgcmVkdWN0aW9uPTE2LAogICAgICAgICAgICAgICAgICAgICAgICAgZHJvcG91dF9wPU5vbmUsIGlucGxhbmVzPTY0LCBpbnB1dF8zeDM9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPTEsIGRvd25zYW1wbGVfcGFkZGluZz0wLAogICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NsYXNzZXM9MTAwMCkKICAgICAgICB3ZWlnaHRzX3BhdGggPSBmJy4uL2lucHV0L3NlX3Jlc25leHQ1MF8zMng0ZC9zZV9yZXNuZXh0NTBfMzJ4NGQucHRoJwogICAgICAgIHNlbGYubmV0LmxvYWRfc3RhdGVfZGljdCh0b3JjaC5sb2FkKHdlaWdodHNfcGF0aCkpCiAgICAgICAgc2VsZi5uZXQuYXZnX3Bvb2wgPSBBdmdQb29sKCkKICAgICAgICBzZWxmLm5ldC5sYXN0X2xpbmVhciA9IG5uLkxpbmVhcihzZWxmLm5ldC5sYXN0X2xpbmVhci5pbl9mZWF0dXJlcywgbnVtX2NsYXNzZXMpCgogICAgZGVmIGZyZXNoX3BhcmFtcyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5uZXQubGFzdF9saW5lYXIucGFyYW1ldGVycygpCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0KHgpCgoKY2xhc3MgU0VSZXNOZVh0MTAxXzMyeDRkKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbnVtX2NsYXNzZXMsIHByZXRyYWluZWQ9RmFsc2UsIGRyb3BvdXQ9RmFsc2UsIG5ldF9jbHM9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5uZXQgPSBTRU5ldChTRVJlc05lWHRCb3R0bGVuZWNrLCBbMywgNCwgMjMsIDNdLCBncm91cHM9MzIsIHJlZHVjdGlvbj0xNiwKICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BvdXRfcD1Ob25lLCBpbnBsYW5lcz02NCwgaW5wdXRfM3gzPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgZG93bnNhbXBsZV9rZXJuZWxfc2l6ZT0xLCBkb3duc2FtcGxlX3BhZGRpbmc9MCwKICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9jbGFzc2VzPTEwMDApCiAgICAgICAgd2VpZ2h0c19wYXRoID0gZicuLi9pbnB1dC9zZV9yZXNuZXh0MTAxXzMyeDRkL3NlX3Jlc25leHQxMDFfMzJ4NGQucHRoJwogICAgICAgIHNlbGYubmV0LmxvYWRfc3RhdGVfZGljdCh0b3JjaC5sb2FkKHdlaWdodHNfcGF0aCkpCiAgICAgICAgc2VsZi5uZXQuYXZnX3Bvb2wgPSBBdmdQb29sKCkKICAgICAgICBzZWxmLm5ldC5sYXN0X2xpbmVhciA9IG5uLkxpbmVhcihzZWxmLm5ldC5sYXN0X2xpbmVhci5pbl9mZWF0dXJlcywgbnVtX2NsYXNzZXMpCgogICAgZGVmIGZyZXNoX3BhcmFtcyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5uZXQubGFzdF9saW5lYXIucGFyYW1ldGVycygpCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0KHgpCgoKIyBHbG9iYWwgQXZlcmFnZSBQb29saW5nIHNhbWUgYXMgbm4uQWRhcHRpdmVBdmdQb29sMmQoMSkgY2hlY2sgaHR0cHM6Ly93d3cueG4tLWVia2M3a3FkLmNvbS9lbnRyeS9weXRvcmNoLXBvb2xpbmcKY2xhc3MgQXZnUG9vbChubi5Nb2R1bGUpOgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgcmV0dXJuIEYuYXZnX3Bvb2wyZCh4LCB4LnNoYXBlWzI6XSkKCgpkZWYgY3JlYXRlX25ldChuZXRfY2xzLCBwcmV0cmFpbmVkOiBib29sKToKICAgIGlmIE9OX0tBR0dMRSBhbmQgcHJldHJhaW5lZDoKICAgICAgICBuZXQgPSBuZXRfY2xzKCkKICAgICAgICBtb2RlbF9uYW1lID0gbmV0X2Nscy5fX25hbWVfXwogICAgICAgIHdlaWdodHNfcGF0aCA9IGYnLi4vaW5wdXQve21vZGVsX25hbWV9L3ttb2RlbF9uYW1lfS5wdGgnCiAgICAgICAgIyBodHRwczovL2dpdGh1Yi5jb20vcHl0b3JjaC92aXNpb24vYmxvYi9tYXN0ZXIvdG9yY2h2aXNpb24vbW9kZWxzL2RlbnNlbmV0LnB5I0wxMjYtTDE0MQogICAgICAgIHBhdHRlcm4gPSByZS5jb21waWxlKAogICAgICAgICAgICByJ14oLipkZW5zZWxheWVyXGQrXC4oPzpub3JtfHJlbHV8Y29udikpXC4oKD86WzEyXSlcLig/OndlaWdodHxiaWFzfHJ1bm5pbmdfbWVhbnxydW5uaW5nX3ZhcikpJCcpCiAgICAgICAgc3RhdGVfZGljdCA9IHRvcmNoLmxvYWQod2VpZ2h0c19wYXRoKQogICAgICAgIGZvciBrZXkgaW4gbGlzdChzdGF0ZV9kaWN0LmtleXMoKSk6CiAgICAgICAgICAgIHJlcyA9IHBhdHRlcm4ubWF0Y2goa2V5KQogICAgICAgICAgICBpZiByZXM6CiAgICAgICAgICAgICAgICBuZXdfa2V5ID0gcmVzLmdyb3VwKDEpICsgcmVzLmdyb3VwKDIpCiAgICAgICAgICAgICAgICBzdGF0ZV9kaWN0W25ld19rZXldID0gc3RhdGVfZGljdFtrZXldCiAgICAgICAgICAgICAgICBkZWwgc3RhdGVfZGljdFtrZXldCiAgICAgICAgbmV0LmxvYWRfc3RhdGVfZGljdChzdGF0ZV9kaWN0KQogICAgICAgIHByaW50KCJzdWNjZXNzIGxvYWQgd2VpZ2h0cyIpCiAgICBlbHNlOgogICAgICAgIG5ldCA9IG5ldF9jbHMocHJldHJhaW5lZD1wcmV0cmFpbmVkKQogICAgcmV0dXJuIG5ldAoKCmNsYXNzIFJlc05ldChubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG51bV9jbGFzc2VzLAogICAgICAgICAgICAgICAgIHByZXRyYWluZWQ9RmFsc2UsIG5ldF9jbHM9TS5yZXNuZXQxMDEsIGRyb3BvdXQ9RmFsc2UpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQogICAgICAgIHNlbGYubmV0ID0gY3JlYXRlX25ldChuZXRfY2xzLCBwcmV0cmFpbmVkPXByZXRyYWluZWQpCiAgICAgICAgc2VsZi5uZXQuYXZncG9vbCA9IEF2Z1Bvb2woKQogICAgICAgIGlmIGRyb3BvdXQ6CiAgICAgICAgICAgIHNlbGYubmV0LmZjID0gbm4uU2VxdWVudGlhbCgKICAgICAgICAgICAgICAgIG5uLkRyb3BvdXQoKSwKICAgICAgICAgICAgICAgIG5uLkxpbmVhcihzZWxmLm5ldC5mYy5pbl9mZWF0dXJlcywgbnVtX2NsYXNzZXMpLAogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5uZXQuZmMgPSBubi5MaW5lYXIoc2VsZi5uZXQuZmMuaW5fZmVhdHVyZXMsIG51bV9jbGFzc2VzKQoKICAgIGRlZiBmcmVzaF9wYXJhbXMoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0LmZjLnBhcmFtZXRlcnMoKQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHJldHVybiBzZWxmLm5ldCh4KQoKCmNsYXNzIEluY2VwdGlvbk5ldChubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG51bV9jbGFzc2VzLAogICAgICAgICAgICAgICAgIHByZXRyYWluZWQ9RmFsc2UsIG5ldF9jbHM9TS5pbmNlcHRpb25fdjMpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQogICAgICAgIHNlbGYubmV0ID0gY3JlYXRlX25ldChuZXRfY2xzLCBwcmV0cmFpbmVkPXByZXRyYWluZWQpCiAgICAgICAgc2VsZi5uZXQuZmMgPSBubi5MaW5lYXIoc2VsZi5uZXQuZmMuaW5fZmVhdHVyZXMsIG51bV9jbGFzc2VzKQogICAgICAgIHNlbGYubmV0LkF1eExvZ2l0cy5mYyA9IG5uLkxpbmVhcihzZWxmLm5ldC5BdXhMb2dpdHMuZmMuaW5fZmVhdHVyZXMsIG51bV9jbGFzc2VzKQoKICAgIGRlZiBmcmVzaF9wYXJhbXMoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0LmZjLnBhcmFtZXRlcnMoKQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHJldHVybiBzZWxmLm5ldCh4KQoKCmNsYXNzIERlbnNlTmV0KG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbnVtX2NsYXNzZXMsCiAgICAgICAgICAgICAgICAgcHJldHJhaW5lZD1GYWxzZSwgbmV0X2Nscz1NLmRlbnNlbmV0MTIxKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IGNyZWF0ZV9uZXQobmV0X2NscywgcHJldHJhaW5lZD1wcmV0cmFpbmVkKQogICAgICAgIHNlbGYuYXZnX3Bvb2wgPSBBdmdQb29sKCkKICAgICAgICBzZWxmLm5ldC5jbGFzc2lmaWVyID0gbm4uTGluZWFyKAogICAgICAgICAgICBzZWxmLm5ldC5jbGFzc2lmaWVyLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKCiAgICBkZWYgZnJlc2hfcGFyYW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLm5ldC5jbGFzc2lmaWVyLnBhcmFtZXRlcnMoKQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIG91dCA9IHNlbGYubmV0LmZlYXR1cmVzKHgpCiAgICAgICAgb3V0ID0gRi5yZWx1KG91dCwgaW5wbGFjZT1UcnVlKQogICAgICAgIG91dCA9IHNlbGYuYXZnX3Bvb2wob3V0KS52aWV3KG91dC5zaXplKDApLCAtMSkKICAgICAgICBvdXQgPSBzZWxmLm5ldC5jbGFzc2lmaWVyKG91dCkKICAgICAgICByZXR1cm4gb3V0CgoKcmVzbmV0MTggPSBwYXJ0aWFsKFJlc05ldCwgbmV0X2Nscz1NLnJlc25ldDE4KQpyZXNuZXQzNCA9IHBhcnRpYWwoUmVzTmV0LCBuZXRfY2xzPU0ucmVzbmV0MzQpCnJlc25ldDUwID0gcGFydGlhbChSZXNOZXQsIG5ldF9jbHM9TS5yZXNuZXQ1MCkKcmVzbmV0MTAxID0gcGFydGlhbChSZXNOZXQsIG5ldF9jbHM9TS5yZXNuZXQxMDEpCnJlc25ldDE1MiA9IHBhcnRpYWwoUmVzTmV0LCBuZXRfY2xzPU0ucmVzbmV0MTUyKQoKZGVuc2VuZXQxMjEgPSBwYXJ0aWFsKERlbnNlTmV0LCBuZXRfY2xzPU0uZGVuc2VuZXQxMjEpCmRlbnNlbmV0MTY5ID0gcGFydGlhbChEZW5zZU5ldCwgbmV0X2Nscz1NLmRlbnNlbmV0MTY5KQpkZW5zZW5ldDIwMSA9IHBhcnRpYWwoRGVuc2VOZXQsIG5ldF9jbHM9TS5kZW5zZW5ldDIwMSkKZGVuc2VuZXQxNjEgPSBwYXJ0aWFsKERlbnNlTmV0LCBuZXRfY2xzPU0uZGVuc2VuZXQxNjEpCgppbmNlcHRpb25fdjMgPSBwYXJ0aWFsKEluY2VwdGlvbk5ldCwgbmV0X2Nscz1NLmluY2VwdGlvbl92MykKCnNlX3Jlc25ldDUwID0gcGFydGlhbChTRVJlc05ldDUwLCBuZXRfY2xzPU5vbmUpCnNlX3Jlc25ldDEwMSA9IHBhcnRpYWwoU0VSZXNOZXQxMDEsIG5ldF9jbHM9Tm9uZSkKc2VfcmVzbmV0MTUyID0gcGFydGlhbChTRVJlc05ldDE1MiwgbmV0X2Nscz1Ob25lKQoKc2VfcmVzbmV4dDUwXzMyeDRkID0gcGFydGlhbChTRVJlc05lWHQ1MF8zMng0ZCwgbmV0X2Nscz1Ob25lKQpzZV9yZXNuZXh0MTAxXzMyeDRkID0gcGFydGlhbChTRVJlc05lWHQxMDFfMzJ4NGQsIG5ldF9jbHM9Tm9uZSkK',
                    'aptos/make_folds.py': 'aW1wb3J0IGFyZ3BhcnNlCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IGRlZmF1bHRkaWN0LCBDb3VudGVyCmltcG9ydCByYW5kb20KCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHRxZG0KCmZyb20gLmRhdGFzZXQgaW1wb3J0IERBVEFfUk9PVAoKCmRlZiBtYWtlX2ZvbGRzKG5fZm9sZHM6IGludCwgc2VlZDogaW50KSAtPiBwZC5EYXRhRnJhbWU6CiAgICBkZiA9IHBkLnJlYWRfY3N2KERBVEFfUk9PVCAvICd0cmFpbi5jc3YnKQogICAgY2xzX2NvdW50cyA9IENvdW50ZXIoZGZbJ2RpYWdub3NpcyddKQogICAgZm9sZF9jbHNfY291bnRzID0gZGVmYXVsdGRpY3QoaW50KQogICAgZm9sZHMgPSBbLTFdICogbGVuKGRmKQogICAgZm9yIGl0ZW0gaW4gdHFkbS50cWRtKGRmLnNhbXBsZShmcmFjPTEsIHJhbmRvbV9zdGF0ZT1zZWVkKS5pdGVydHVwbGVzKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw9bGVuKGRmKSk6CiAgICAgICAgY2xzID0gbWluKGl0ZW0uYXR0cmlidXRlX2lkcy5zcGxpdCgpLCBrZXk9bGFtYmRhIGNsczogY2xzX2NvdW50c1tjbHNdKQogICAgICAgIGZvbGRfY291bnRzID0gWyhmLCBmb2xkX2Nsc19jb3VudHNbZiwgY2xzXSkgZm9yIGYgaW4gcmFuZ2Uobl9mb2xkcyldCiAgICAgICAgbWluX2NvdW50ID0gbWluKFtjb3VudCBmb3IgXywgY291bnQgaW4gZm9sZF9jb3VudHNdKQogICAgICAgIHJhbmRvbS5zZWVkKGl0ZW0uSW5kZXgpCiAgICAgICAgZm9sZCA9IHJhbmRvbS5jaG9pY2UoW2YgZm9yIGYsIGNvdW50IGluIGZvbGRfY291bnRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvdW50ID09IG1pbl9jb3VudF0pCiAgICAgICAgZm9sZHNbaXRlbS5JbmRleF0gPSBmb2xkCiAgICAgICAgZm9yIGNscyBpbiBpdGVtLmF0dHJpYnV0ZV9pZHMuc3BsaXQoKToKICAgICAgICAgICAgZm9sZF9jbHNfY291bnRzW2ZvbGQsIGNsc10gKz0gMQogICAgZGZbJ2ZvbGQnXSA9IGZvbGRzCiAgICByZXR1cm4gZGYKCgpkZWYgbWFpbigpOgogICAgcGFyc2VyID0gYXJncGFyc2UuQXJndW1lbnRQYXJzZXIoKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLS1uLWZvbGRzJywgdHlwZT1pbnQsIGRlZmF1bHQ9NSkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoJy0tc2VlZCcsIHR5cGU9aW50LCBkZWZhdWx0PTQyKQogICAgYXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIGRmID0gbWFrZV9mb2xkcyhuX2ZvbGRzPWFyZ3Mubl9mb2xkcywgc2VlZD1hcmdzLnNlZWQpCiAgICBkZi50b19jc3YoJ2ZvbGRzLmNzdicsIGluZGV4PU5vbmUpCgoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgIG1haW4oKQo=',
                    'aptos/dataset.py': 'ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdHlwaW5nIGltcG9ydCBDYWxsYWJsZSwgTGlzdAoKaW1wb3J0IGN2MgppbXBvcnQgcGFuZGFzIGFzIHBkCmZyb20gUElMIGltcG9ydCBJbWFnZQppbXBvcnQgdG9yY2gKZnJvbSB0b3JjaC51dGlscy5kYXRhIGltcG9ydCBEYXRhc2V0Cgpmcm9tIC50cmFuc2Zvcm1zIGltcG9ydCB0ZW5zb3JfdHJhbnNmb3JtCmZyb20gLnV0aWxzIGltcG9ydCBPTl9LQUdHTEUKCgpEQVRBX1JPT1QgPSBQYXRoKCcuLi9pbnB1dC9hcHRvczIwMTktYmxpbmRuZXNzLWRldGVjdGlvbicgaWYgT05fS0FHR0xFIGVsc2UgJy4vZGF0YScpCgoKY2xhc3MgVHJhaW5EYXRhc2V0KERhdGFzZXQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHJvb3Q6IFBhdGgsIGRmOiBwZC5EYXRhRnJhbWUsCiAgICAgICAgICAgICAgICAgaW1hZ2VfdHJhbnNmb3JtOiBDYWxsYWJsZSwgZGVidWc6IGJvb2wgPSBUcnVlKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLl9yb290ID0gcm9vdAogICAgICAgIHNlbGYuX2RmID0gZGYKICAgICAgICBzZWxmLl9pbWFnZV90cmFuc2Zvcm0gPSBpbWFnZV90cmFuc2Zvcm0KICAgICAgICBzZWxmLl9kZWJ1ZyA9IGRlYnVnCgogICAgZGVmIF9fbGVuX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGxlbihzZWxmLl9kZikKCiAgICBkZWYgX19nZXRpdGVtX18oc2VsZiwgaWR4OiBpbnQpOgogICAgICAgIGl0ZW0gPSBzZWxmLl9kZi5pbG9jW2lkeF0KICAgICAgICBpbWFnZSA9IGxvYWRfdHJhbnNmb3JtX2ltYWdlKAogICAgICAgICAgICBpdGVtLCBzZWxmLl9yb290LCBzZWxmLl9pbWFnZV90cmFuc2Zvcm0sIGRlYnVnPXNlbGYuX2RlYnVnKQogICAgICAgIHRhcmdldCA9IHRvcmNoLnRlbnNvcihzZWxmLl9kZi5sb2NbaWR4LCAnZGlhZ25vc2lzJ10pCiAgICAgICAgcmV0dXJuIGltYWdlLCB0YXJnZXQKCgpjbGFzcyBUVEFEYXRhc2V0OgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHJvb3Q6IFBhdGgsIGRmOiBwZC5EYXRhRnJhbWUsCiAgICAgICAgICAgICAgICAgaW1hZ2VfdHJhbnNmb3JtOiBDYWxsYWJsZSwgdHRhOiBpbnQpOgogICAgICAgIHNlbGYuX3Jvb3QgPSByb290CiAgICAgICAgc2VsZi5fZGYgPSBkZgogICAgICAgIHNlbGYuX2ltYWdlX3RyYW5zZm9ybSA9IGltYWdlX3RyYW5zZm9ybQogICAgICAgIHNlbGYuX3R0YSA9IHR0YQoKICAgIGRlZiBfX2xlbl9fKHNlbGYpOgogICAgICAgIHJldHVybiBsZW4oc2VsZi5fZGYpICogc2VsZi5fdHRhCgogICAgZGVmIF9fZ2V0aXRlbV9fKHNlbGYsIGlkeCk6CiAgICAgICAgaXRlbSA9IHNlbGYuX2RmLmlsb2NbaWR4ICUgbGVuKHNlbGYuX2RmKV0KICAgICAgICBpbWFnZSA9IGxvYWRfdHJhbnNmb3JtX2ltYWdlKGl0ZW0sIHNlbGYuX3Jvb3QsIHNlbGYuX2ltYWdlX3RyYW5zZm9ybSkKICAgICAgICByZXR1cm4gaW1hZ2UsIGl0ZW0uaWQKCgpkZWYgbG9hZF90cmFuc2Zvcm1faW1hZ2UoCiAgICAgICAgaXRlbSwgcm9vdDogUGF0aCwgaW1hZ2VfdHJhbnNmb3JtOiBDYWxsYWJsZSwgZGVidWc6IGJvb2wgPSBGYWxzZSk6CiAgICBpbWFnZSA9IGxvYWRfaW1hZ2UoaXRlbSwgcm9vdCkKICAgIGltYWdlID0gaW1hZ2VfdHJhbnNmb3JtKGltYWdlKQogICAgaWYgZGVidWc6CiAgICAgICAgaW1hZ2Uuc2F2ZSgnX2RlYnVnLnBuZycpCiAgICByZXR1cm4gdGVuc29yX3RyYW5zZm9ybShpbWFnZSkKCgpkZWYgbG9hZF9pbWFnZShpdGVtLCByb290OiBQYXRoKSAtPiBJbWFnZS5JbWFnZToKICAgIGltYWdlID0gY3YyLmltcmVhZChzdHIocm9vdCAvIGYne2l0ZW0uaWR9LnBuZycpKQogICAgaW1hZ2UgPSBjdjIuY3Z0Q29sb3IoaW1hZ2UsIGN2Mi5DT0xPUl9CR1IyUkdCKQogICAgcmV0dXJuIEltYWdlLmZyb21hcnJheShpbWFnZSkKCgpkZWYgZ2V0X2lkcyhyb290OiBQYXRoKSAtPiBMaXN0W3N0cl06CiAgICByZXR1cm4gc29ydGVkKHtwLm5hbWUuc3BsaXQoJ18nKVswXSBmb3IgcCBpbiByb290Lmdsb2IoJyoucG5nJyl9KQo=',
                    'aptos/utils.py': 'ZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGpzb24KaW1wb3J0IGdsb2IKaW1wb3J0IG9zCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aApmcm9tIG11bHRpcHJvY2Vzc2luZy5wb29sIGltcG9ydCBUaHJlYWRQb29sCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0CgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZApmcm9tIHNjaXB5LnN0YXRzLm1zdGF0cyBpbXBvcnQgZ21lYW4KaW1wb3J0IHRvcmNoCmZyb20gdG9yY2ggaW1wb3J0IG5uCmZyb20gdG9yY2gudXRpbHMuZGF0YSBpbXBvcnQgRGF0YUxvYWRlcgoKCk9OX0tBR0dMRTogYm9vbCA9ICdLQUdHTEVfV09SS0lOR19ESVInIGluIG9zLmVudmlyb24KCgpkZWYgZ21lYW5fZGYoZGY6IHBkLkRhdGFGcmFtZSkgLT4gcGQuRGF0YUZyYW1lOgogICAgcmV0dXJuIGRmLmdyb3VwYnkobGV2ZWw9MCkuYWdnKGxhbWJkYSB4OiBnbWVhbihsaXN0KHgpKSkKCgpkZWYgbWVhbl9kZihkZjogcGQuRGF0YUZyYW1lKSAtPiBwZC5EYXRhRnJhbWU6CiAgICByZXR1cm4gZGYuZ3JvdXBieShsZXZlbD0wKS5tZWFuKCkKCgpkZWYgbG9hZF9tb2RlbChtb2RlbDogbm4uTW9kdWxlLCBwYXRoOiBQYXRoKSAtPiBEaWN0OgogICAgc3RhdGUgPSB0b3JjaC5sb2FkKHN0cihwYXRoKSkKICAgIG1vZGVsLmxvYWRfc3RhdGVfZGljdChzdGF0ZVsnbW9kZWwnXSkKICAgIHByaW50KCdMb2FkZWQgbW9kZWwgZnJvbSBlcG9jaCB7ZXBvY2h9LCBzdGVwIHtzdGVwOix9Jy5mb3JtYXQoKipzdGF0ZSkpCiAgICByZXR1cm4gc3RhdGUKCgpjbGFzcyBUaHJlYWRpbmdEYXRhTG9hZGVyKERhdGFMb2FkZXIpOgogICAgZGVmIF9faXRlcl9fKHNlbGYpOgogICAgICAgIHNhbXBsZV9pdGVyID0gaXRlcihzZWxmLmJhdGNoX3NhbXBsZXIpCiAgICAgICAgaWYgc2VsZi5udW1fd29ya2VycyA9PSAwOgogICAgICAgICAgICBmb3IgaW5kaWNlcyBpbiBzYW1wbGVfaXRlcjoKICAgICAgICAgICAgICAgIHlpZWxkIHNlbGYuY29sbGF0ZV9mbihbc2VsZi5fZ2V0X2l0ZW0oaSkgZm9yIGkgaW4gaW5kaWNlc10pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJlZmV0Y2ggPSAxCiAgICAgICAgICAgIHdpdGggVGhyZWFkUG9vbChwcm9jZXNzZXM9c2VsZi5udW1fd29ya2VycykgYXMgcG9vbDoKICAgICAgICAgICAgICAgIGZ1dHVyZXMgPSBbXQogICAgICAgICAgICAgICAgZm9yIGluZGljZXMgaW4gc2FtcGxlX2l0ZXI6CiAgICAgICAgICAgICAgICAgICAgZnV0dXJlcy5hcHBlbmQoW3Bvb2wuYXBwbHlfYXN5bmMoc2VsZi5fZ2V0X2l0ZW0sIGFyZ3M9KGksKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaW5kaWNlc10pCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGZ1dHVyZXMpID4gcHJlZmV0Y2g6CiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHNlbGYuY29sbGF0ZV9mbihbZi5nZXQoKSBmb3IgZiBpbiBmdXR1cmVzLnBvcCgwKV0pCiAgICAgICAgICAgICAgICAgICAgIyBpdGVtcyA9IHBvb2wubWFwKGxhbWJkYSBpOiBzZWxmLmRhdGFzZXRbaV0sIGluZGljZXMpCiAgICAgICAgICAgICAgICAgICAgIyB5aWVsZCBzZWxmLmNvbGxhdGVfZm4oaXRlbXMpCiAgICAgICAgICAgICAgICBmb3IgYmF0Y2hfZnV0dXJlcyBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgICAgIHlpZWxkIHNlbGYuY29sbGF0ZV9mbihbZi5nZXQoKSBmb3IgZiBpbiBiYXRjaF9mdXR1cmVzXSkKCiAgICBkZWYgX2dldF9pdGVtKHNlbGYsIGkpOgogICAgICAgIHJldHVybiBzZWxmLmRhdGFzZXRbaV0KCgpkZWYgd3JpdGVfZXZlbnQobG9nLCBzdGVwOiBpbnQsICoqZGF0YSk6CiAgICBkYXRhWydzdGVwJ10gPSBzdGVwCiAgICBkYXRhWydkdCddID0gZGF0ZXRpbWUubm93KCkuaXNvZm9ybWF0KCkKICAgIGxvZy53cml0ZShqc29uLmR1bXBzKGRhdGEsIHNvcnRfa2V5cz1UcnVlKSkKICAgIGxvZy53cml0ZSgnXG4nKQogICAgbG9nLmZsdXNoKCkKCgpkZWYgcGxvdCgqYXJncywgeW1pbj1Ob25lLCB5bWF4PU5vbmUsIHhtaW49Tm9uZSwgeG1heD1Ob25lLCBwYXJhbXM9RmFsc2UsCiAgICAgICAgIG1heF9wb2ludHM9MjAwLCBsZWdlbmQ9VHJ1ZSwgdGl0bGU9Tm9uZSwKICAgICAgICAgcHJpbnRfa2V5cz1GYWxzZSwgcHJpbnRfcGF0aHM9RmFsc2UsIHBsdD1Ob25lLCBuZXdmaWd1cmU9VHJ1ZSwKICAgICAgICAgeF9zY2FsZT0xKToKICAgICIiIgogICAgVXNlIGluIHRoZSBub3RlYm9vayBsaWtlIHRoaXM6OgogICAgICAgICVtYXRwbG90bGliIGlubGluZQogICAgICAgIGZyb20gaW1ldC51dGlscyBpbXBvcnQgcGxvdAogICAgICAgIHBsb3QoJy4vcnVucy9vYzInLCAnLi9ydW5zL29jMScsICdsb3NzJywgJ3ZhbGlkX2xvc3MnKQogICAgIiIiCiAgICBpbXBvcnQganNvbl9saW5lcyAgIyBubyBhdmFpbGFibGUgb24gS2FnZ2xlCgogICAgaWYgcGx0IGlzIE5vbmU6CiAgICAgICAgZnJvbSBtYXRwbG90bGliIGltcG9ydCBweXBsb3QgYXMgcGx0CiAgICBwYXRocywga2V5cyA9IFtdLCBbXQogICAgZm9yIHggaW4gYXJnczoKICAgICAgICBpZiB4LnN0YXJ0c3dpdGgoJy4nKSBvciAnLycgaW4geDoKICAgICAgICAgICAgaWYgJyonIGluIHg6CiAgICAgICAgICAgICAgICBwYXRocy5leHRlbmQoZ2xvYi5nbG9iKHgpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcGF0aHMuYXBwZW5kKHgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAga2V5cy5hcHBlbmQoeCkKICAgIGlmIHByaW50X3BhdGhzOgogICAgICAgIHByaW50KCdGb3VuZCBwYXRoczoge30nLmZvcm1hdCgnICcuam9pbihzb3J0ZWQocGF0aHMpKSkpCiAgICBpZiBuZXdmaWd1cmU6CiAgICAgICAgcGx0LmZpZ3VyZShmaWdzaXplPSgxMiwgOCkpCiAgICBrZXlzID0ga2V5cyBvciBbJ2xvc3MnLCAndmFsaWRfbG9zcyddCgogICAgeWxpbV9rdyA9IHt9CiAgICBpZiB5bWluIGlzIG5vdCBOb25lOgogICAgICAgIHlsaW1fa3dbJ2JvdHRvbSddID0geW1pbgogICAgaWYgeW1heCBpcyBub3QgTm9uZToKICAgICAgICB5bGltX2t3Wyd0b3AnXSA9IHltYXgKICAgIGlmIHlsaW1fa3c6CiAgICAgICAgcGx0LnlsaW0oKip5bGltX2t3KQoKICAgIHhsaW1fa3cgPSB7fQogICAgaWYgeG1pbiBpcyBub3QgTm9uZToKICAgICAgICB4bGltX2t3WydsZWZ0J10gPSB4bWluCiAgICBpZiB4bWF4IGlzIG5vdCBOb25lOgogICAgICAgIHhsaW1fa3dbJ3JpZ2h0J10gPSB4bWF4CiAgICBpZiB4bGltX2t3OgogICAgICAgIHBsdC54bGltKCoqeGxpbV9rdykKICAgIGFsbF9rZXlzID0gc2V0KCkKICAgIGZvciBwYXRoIGluIHNvcnRlZChwYXRocyk6CiAgICAgICAgcGF0aCA9IFBhdGgocGF0aCkKICAgICAgICB3aXRoIGpzb25fbGluZXMub3BlbihwYXRoIC8gJ3RyYWluLmxvZycsIGJyb2tlbj1UcnVlKSBhcyBmOgogICAgICAgICAgICBldmVudHMgPSBsaXN0KGYpCiAgICAgICAgYWxsX2tleXMudXBkYXRlKGsgZm9yIGUgaW4gZXZlbnRzIGZvciBrIGluIGUpCiAgICAgICAgZm9yIGtleSBpbiBzb3J0ZWQoa2V5cyk6CiAgICAgICAgICAgIHhzLCB5cywgeXNfZXJyID0gW10sIFtdLCBbXQogICAgICAgICAgICBmb3IgZSBpbiBldmVudHM6CiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gZToKICAgICAgICAgICAgICAgICAgICB4cy5hcHBlbmQoZVsnc3RlcCddICogeF9zY2FsZSkKICAgICAgICAgICAgICAgICAgICB5cy5hcHBlbmQoZVtrZXldKQogICAgICAgICAgICAgICAgICAgIHN0ZF9rZXkgPSBrZXkgKyAnX3N0ZCcKICAgICAgICAgICAgICAgICAgICBpZiBzdGRfa2V5IGluIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHlzX2Vyci5hcHBlbmQoZVtzdGRfa2V5XSkKICAgICAgICAgICAgaWYgeHM6CiAgICAgICAgICAgICAgICBpZiBucC5pc25hbih5cykuYW55KCk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ1dhcm5pbmc6IE5hTiB7fSBmb3Ige30nLmZvcm1hdChrZXksIHBhdGgpKQogICAgICAgICAgICAgICAgaWYgbGVuKHhzKSA+IDIgKiBtYXhfcG9pbnRzOgogICAgICAgICAgICAgICAgICAgIGluZGljZXMgPSAobnAuYXJhbmdlKDAsIGxlbih4cykgLSAxLCBsZW4oeHMpIC8gbWF4X3BvaW50cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hc3R5cGUobnAuaW50MzIpKQogICAgICAgICAgICAgICAgICAgIHhzID0gbnAuYXJyYXkoeHMpW2luZGljZXNbMTpdXQogICAgICAgICAgICAgICAgICAgIHlzID0gX3Ntb290aCh5cywgaW5kaWNlcykKICAgICAgICAgICAgICAgICAgICBpZiB5c19lcnI6CiAgICAgICAgICAgICAgICAgICAgICAgIHlzX2VyciA9IF9zbW9vdGgoeXNfZXJyLCBpbmRpY2VzKQogICAgICAgICAgICAgICAgbGFiZWwgPSAne306IHt9Jy5mb3JtYXQocGF0aCwga2V5KQogICAgICAgICAgICAgICAgaWYgbGFiZWwuc3RhcnRzd2l0aCgnXycpOgogICAgICAgICAgICAgICAgICAgIGxhYmVsID0gJyAnICsgbGFiZWwKICAgICAgICAgICAgICAgIGlmIHlzX2VycjoKICAgICAgICAgICAgICAgICAgICB5c19lcnIgPSAxLjk2ICogbnAuYXJyYXkoeXNfZXJyKQogICAgICAgICAgICAgICAgICAgIHBsdC5lcnJvcmJhcih4cywgeXMsIHllcnI9eXNfZXJyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbXQ9Jy1vJywgY2Fwc2l6ZT01LCBjYXB0aGljaz0yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD1sYWJlbCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcGx0LnBsb3QoeHMsIHlzLCBsYWJlbD1sYWJlbCkKICAgICAgICAgICAgICAgIHBsdC5sZWdlbmQoKQogICAgaWYgbmV3ZmlndXJlOgogICAgICAgIHBsdC5ncmlkKCkKICAgIGlmIGxlZ2VuZDoKICAgICAgICBwbHQubGVnZW5kKCkKICAgIGlmIHRpdGxlOgogICAgICAgIHBsdC50aXRsZSh0aXRsZSkKICAgIGlmIHByaW50X2tleXM6CiAgICAgICAgcHJpbnQoJ0ZvdW5kIGtleXM6IHt9JwogICAgICAgICAgICAgIC5mb3JtYXQoJywgJy5qb2luKHNvcnRlZChhbGxfa2V5cyAtIHsnc3RlcCcsICdkdCd9KSkpKQoKCmRlZiBfc21vb3RoKHlzLCBpbmRpY2VzKToKICAgIHJldHVybiBbbnAubWVhbih5c1tpZHg6IGluZGljZXNbaSArIDFdXSkKICAgICAgICAgICAgZm9yIGksIGlkeCBpbiBlbnVtZXJhdGUoaW5kaWNlc1s6LTFdKV0K',
                    'aptos/main.py': 'aW1wb3J0IGFyZ3BhcnNlCmZyb20gaXRlcnRvb2xzIGltcG9ydCBpc2xpY2UKaW1wb3J0IGpzb24KZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmltcG9ydCBzaHV0aWwKaW1wb3J0IHdhcm5pbmdzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0CgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgc2NpcHkgYXMgc3AKZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHBhcnRpYWwKZnJvbSBza2xlYXJuIGltcG9ydCBtZXRyaWNzCmZyb20gc2tsZWFybi5tZXRyaWNzIGltcG9ydCBjb2hlbl9rYXBwYV9zY29yZQpmcm9tIHNrbGVhcm4uZXhjZXB0aW9ucyBpbXBvcnQgVW5kZWZpbmVkTWV0cmljV2FybmluZwppbXBvcnQgdG9yY2gKaW1wb3J0IHRvcmNoLm5uLmZ1bmN0aW9uYWwgYXMgRgpmcm9tIHRvcmNoIGltcG9ydCBubiwgY3VkYQpmcm9tIHRvcmNoLm9wdGltIGltcG9ydCBBZGFtCmltcG9ydCB0cWRtCgpmcm9tIC4gaW1wb3J0IG1vZGVscwpmcm9tIC5kYXRhc2V0IGltcG9ydCBUcmFpbkRhdGFzZXQsIFRUQURhdGFzZXQsIGdldF9pZHMsIERBVEFfUk9PVApmcm9tIC50cmFuc2Zvcm1zIGltcG9ydCB0cmFpbl90cmFuc2Zvcm0sIHRlc3RfdHJhbnNmb3JtCmZyb20gLnV0aWxzIGltcG9ydCAoCiAgICB3cml0ZV9ldmVudCwgbG9hZF9tb2RlbCwgbWVhbl9kZiwgVGhyZWFkaW5nRGF0YUxvYWRlciBhcyBEYXRhTG9hZGVyLAogICAgT05fS0FHR0xFKQoKCmRlZiBxdWFkcmF0aWNfd2VpZ2h0ZWRfa2FwcGEoeV9oYXQsIHkpOgogICAgcmV0dXJuIHRvcmNoLnRlbnNvcihjb2hlbl9rYXBwYV9zY29yZSh0b3JjaC5hcmdtYXgoeV9oYXQsIDEpLCB5LCB3ZWlnaHRzPSdxdWFkcmF0aWMnKSwgZGV2aWNlPSdjdWRhOjAnKQoKCmNsYXNzIE9wdGltaXplZFJvdW5kZXIob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLmNvZWZfID0gMAoKICAgIGRlZiBfa2FwcGFfbG9zcyhzZWxmLCBjb2VmLCBYLCB5KToKICAgICAgICBYX3AgPSBucC5jb3B5KFgpCiAgICAgICAgZm9yIGksIHByZWQgaW4gZW51bWVyYXRlKFhfcCk6CiAgICAgICAgICAgIGlmIHByZWQgPCBjb2VmWzBdOgogICAgICAgICAgICAgICAgWF9wW2ldID0gMAogICAgICAgICAgICBlbGlmIHByZWQgPj0gY29lZlswXSBhbmQgcHJlZCA8IGNvZWZbMV06CiAgICAgICAgICAgICAgICBYX3BbaV0gPSAxCiAgICAgICAgICAgIGVsaWYgcHJlZCA+PSBjb2VmWzFdIGFuZCBwcmVkIDwgY29lZlsyXToKICAgICAgICAgICAgICAgIFhfcFtpXSA9IDIKICAgICAgICAgICAgZWxpZiBwcmVkID49IGNvZWZbMl0gYW5kIHByZWQgPCBjb2VmWzNdOgogICAgICAgICAgICAgICAgWF9wW2ldID0gMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgWF9wW2ldID0gNAoKICAgICAgICBsbCA9IG1ldHJpY3MuY29oZW5fa2FwcGFfc2NvcmUoeSwgWF9wLCB3ZWlnaHRzPSdxdWFkcmF0aWMnKQogICAgICAgIHJldHVybiAtbGwKCiAgICBkZWYgZml0KHNlbGYsIFgsIHkpOgogICAgICAgIGxvc3NfcGFydGlhbCA9IHBhcnRpYWwoc2VsZi5fa2FwcGFfbG9zcywgWD1YLCB5PXkpCiAgICAgICAgaW5pdGlhbF9jb2VmID0gWzAuNSwgMS41LCAyLjUsIDMuNV0KICAgICAgICBzZWxmLmNvZWZfID0gc3Aub3B0aW1pemUubWluaW1pemUobG9zc19wYXJ0aWFsLCBpbml0aWFsX2NvZWYsIG1ldGhvZD0nbmVsZGVyLW1lYWQnKQoKICAgIGRlZiBwcmVkaWN0KHNlbGYsIFgsIGNvZWYpOgogICAgICAgIFhfcCA9IG5wLmNvcHkoWCkKICAgICAgICBmb3IgaSwgcHJlZCBpbiBlbnVtZXJhdGUoWF9wKToKICAgICAgICAgICAgaWYgcHJlZCA8IGNvZWZbMF06CiAgICAgICAgICAgICAgICBYX3BbaV0gPSAwCiAgICAgICAgICAgIGVsaWYgcHJlZCA+PSBjb2VmWzBdIGFuZCBwcmVkIDwgY29lZlsxXToKICAgICAgICAgICAgICAgIFhfcFtpXSA9IDEKICAgICAgICAgICAgZWxpZiBwcmVkID49IGNvZWZbMV0gYW5kIHByZWQgPCBjb2VmWzJdOgogICAgICAgICAgICAgICAgWF9wW2ldID0gMgogICAgICAgICAgICBlbGlmIHByZWQgPj0gY29lZlsyXSBhbmQgcHJlZCA8IGNvZWZbM106CiAgICAgICAgICAgICAgICBYX3BbaV0gPSAzCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBYX3BbaV0gPSA0CiAgICAgICAgcmV0dXJuIFhfcAoKICAgIGRlZiBjb2VmZmljaWVudHMoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuY29lZl9bJ3gnXQoKCmRlZiBtYWluKCk6CiAgICBwYXJzZXIgPSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNlcigpCiAgICBhcmcgPSBwYXJzZXIuYWRkX2FyZ3VtZW50CiAgICBhcmcoJ21vZGUnLCBjaG9pY2VzPVsndHJhaW4nLCAndmFsaWRhdGUnLCAncHJlZGljdF92YWxpZCcsICdwcmVkaWN0X3Rlc3QnXSkKICAgIGFyZygncnVuX3Jvb3QnKQogICAgYXJnKCctLW1vZGVsJywgZGVmYXVsdD0ncmVzbmV0MTAxJykKICAgIGFyZygnLS1sb3NzJywgZGVmYXVsdD0nYmNlJykKICAgIGFyZygnLS1wcmV0cmFpbmVkJywgdHlwZT1pbnQsIGRlZmF1bHQ9MSkKICAgIGFyZygnLS1iYXRjaC1zaXplJywgdHlwZT1pbnQsIGRlZmF1bHQ9NjQpCiAgICBhcmcoJy0tc3RlcCcsIHR5cGU9aW50LCBkZWZhdWx0PTEpCiAgICBhcmcoJy0td29ya2VycycsIHR5cGU9aW50LCBkZWZhdWx0PTIgaWYgT05fS0FHR0xFIGVsc2UgNCkKICAgIGFyZygnLS1scicsIHR5cGU9ZmxvYXQsIGRlZmF1bHQ9MWUtNCkKICAgIGFyZygnLS1wYXRpZW5jZScsIHR5cGU9aW50LCBkZWZhdWx0PTQpCiAgICBhcmcoJy0tY2xlYW4nLCBhY3Rpb249J3N0b3JlX3RydWUnKQogICAgYXJnKCctLW4tZXBvY2hzJywgdHlwZT1pbnQsIGRlZmF1bHQ9MTAwKQogICAgYXJnKCctLWVwb2NoLXNpemUnLCB0eXBlPWludCkKICAgIGFyZygnLS10dGEnLCB0eXBlPWludCwgZGVmYXVsdD00KQogICAgYXJnKCctLXVzZS1zYW1wbGUnLCBhY3Rpb249J3N0b3JlX3RydWUnLCBoZWxwPSd1c2UgYSBzYW1wbGUgb2YgdGhlIGRhdGFzZXQnKQogICAgYXJnKCctLWRlYnVnJywgYWN0aW9uPSdzdG9yZV90cnVlJykKICAgIGFyZygnLS1saW1pdCcsIHR5cGU9aW50KQogICAgYXJnKCctLWZvbGQnLCB0eXBlPWludCwgZGVmYXVsdD0wKQogICAgYXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKCiAgICBydW5fcm9vdCA9IFBhdGgoYXJncy5ydW5fcm9vdCkKICAgIGZvbGRzID0gcGQucmVhZF9jc3YoJ2ZvbGRzLmNzdicpCiAgICB0cmFpbl9yb290ID0gREFUQV9ST09UIC8gKCd0cmFpbl9zYW1wbGUnIGlmIGFyZ3MudXNlX3NhbXBsZSBlbHNlICd0cmFpbicpCiAgICBpZiBhcmdzLnVzZV9zYW1wbGU6CiAgICAgICAgZm9sZHMgPSBmb2xkc1tmb2xkc1snSWQnXS5pc2luKHNldChnZXRfaWRzKHRyYWluX3Jvb3QpKSldCiAgICB0cmFpbl9mb2xkID0gZm9sZHNbZm9sZHNbJ2ZvbGQnXSAhPSBhcmdzLmZvbGRdCiAgICB2YWxpZF9mb2xkID0gZm9sZHNbZm9sZHNbJ2ZvbGQnXSA9PSBhcmdzLmZvbGRdCiAgICBpZiBhcmdzLmxpbWl0OgogICAgICAgIHRyYWluX2ZvbGQgPSB0cmFpbl9mb2xkWzphcmdzLmxpbWl0XQogICAgICAgIHZhbGlkX2ZvbGQgPSB2YWxpZF9mb2xkWzphcmdzLmxpbWl0XQoKICAgIGRlZiBtYWtlX2xvYWRlcihkZjogcGQuRGF0YUZyYW1lLCBpbWFnZV90cmFuc2Zvcm0pIC0+IERhdGFMb2FkZXI6CiAgICAgICAgcmV0dXJuIERhdGFMb2FkZXIoCiAgICAgICAgICAgIFRyYWluRGF0YXNldCh0cmFpbl9yb290LCBkZiwgaW1hZ2VfdHJhbnNmb3JtLCBkZWJ1Zz1hcmdzLmRlYnVnKSwKICAgICAgICAgICAgc2h1ZmZsZT1UcnVlLAogICAgICAgICAgICBiYXRjaF9zaXplPWFyZ3MuYmF0Y2hfc2l6ZSwKICAgICAgICAgICAgbnVtX3dvcmtlcnM9YXJncy53b3JrZXJzLAogICAgICAgICkKCiAgICBjcml0ZXJpb24gPSBubi5NU0VMb3NzKCkKCiAgICBtb2RlbCA9IGdldGF0dHIobW9kZWxzLCBhcmdzLm1vZGVsKShudW1fY2xhc3Nlcz0xLCBwcmV0cmFpbmVkPWFyZ3MucHJldHJhaW5lZCkKICAgIHVzZV9jdWRhID0gY3VkYS5pc19hdmFpbGFibGUoKQogICAgZnJlc2hfcGFyYW1zID0gbGlzdChtb2RlbC5mcmVzaF9wYXJhbXMoKSkKICAgIGFsbF9wYXJhbXMgPSBsaXN0KG1vZGVsLnBhcmFtZXRlcnMoKSkKICAgIGlmIHVzZV9jdWRhOgogICAgICAgIG1vZGVsID0gbW9kZWwuY3VkYSgpCgogICAgaWYgYXJncy5tb2RlID09ICd0cmFpbic6CiAgICAgICAgaWYgcnVuX3Jvb3QuZXhpc3RzKCkgYW5kIGFyZ3MuY2xlYW46CiAgICAgICAgICAgIHNodXRpbC5ybXRyZWUocnVuX3Jvb3QpCiAgICAgICAgcnVuX3Jvb3QubWtkaXIoZXhpc3Rfb2s9VHJ1ZSwgcGFyZW50cz1UcnVlKQogICAgICAgIChydW5fcm9vdCAvICdwYXJhbXMuanNvbicpLndyaXRlX3RleHQoCiAgICAgICAgICAgIGpzb24uZHVtcHModmFycyhhcmdzKSwgaW5kZW50PTQsIHNvcnRfa2V5cz1UcnVlKSkKCiAgICAgICAgdHJhaW5fbG9hZGVyID0gbWFrZV9sb2FkZXIodHJhaW5fZm9sZCwgdHJhaW5fdHJhbnNmb3JtKQogICAgICAgIHZhbGlkX2xvYWRlciA9IG1ha2VfbG9hZGVyKHZhbGlkX2ZvbGQsIHRlc3RfdHJhbnNmb3JtKQogICAgICAgIHByaW50KGYne2xlbih0cmFpbl9sb2FkZXIuZGF0YXNldCk6LH0gaXRlbXMgaW4gdHJhaW4sICcKICAgICAgICAgICAgICBmJ3tsZW4odmFsaWRfbG9hZGVyLmRhdGFzZXQpOix9IGluIHZhbGlkJykKCiAgICAgICAgdHJhaW5fa3dhcmdzID0gZGljdCgKICAgICAgICAgICAgYXJncz1hcmdzLAogICAgICAgICAgICBtb2RlbD1tb2RlbCwKICAgICAgICAgICAgY3JpdGVyaW9uPWNyaXRlcmlvbiwKICAgICAgICAgICAgdHJhaW5fbG9hZGVyPXRyYWluX2xvYWRlciwKICAgICAgICAgICAgdmFsaWRfbG9hZGVyPXZhbGlkX2xvYWRlciwKICAgICAgICAgICAgcGF0aWVuY2U9YXJncy5wYXRpZW5jZSwKICAgICAgICAgICAgaW5pdF9vcHRpbWl6ZXI9bGFtYmRhIHBhcmFtcywgbHI6IEFkYW0ocGFyYW1zLCBsciksCiAgICAgICAgICAgIHVzZV9jdWRhPXVzZV9jdWRhLAogICAgICAgICkKCiAgICAgICAgaWYgYXJncy5wcmV0cmFpbmVkOgogICAgICAgICAgICBpZiB0cmFpbihwYXJhbXM9ZnJlc2hfcGFyYW1zLCBuX2Vwb2Nocz0xLCAqKnRyYWluX2t3YXJncyk6CiAgICAgICAgICAgICAgICB0cmFpbihwYXJhbXM9YWxsX3BhcmFtcywgKip0cmFpbl9rd2FyZ3MpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdHJhaW4ocGFyYW1zPWFsbF9wYXJhbXMsICoqdHJhaW5fa3dhcmdzKQoKICAgIGVsaWYgYXJncy5tb2RlID09ICd2YWxpZGF0ZSc6CiAgICAgICAgdmFsaWRfbG9hZGVyID0gbWFrZV9sb2FkZXIodmFsaWRfZm9sZCwgdGVzdF90cmFuc2Zvcm0pCiAgICAgICAgbG9hZF9tb2RlbChtb2RlbCwgcnVuX3Jvb3QgLyAnbW9kZWwucHRoJykKICAgICAgICB2YWxpZGF0aW9uKG1vZGVsLCBjcml0ZXJpb24sIHRxZG0udHFkbSh2YWxpZF9sb2FkZXIsIGRlc2M9J1ZhbGlkYXRpb24nKSwKICAgICAgICAgICAgICAgICAgIHVzZV9jdWRhPXVzZV9jdWRhKQoKCmRlZiB0cmFpbihhcmdzLCBtb2RlbDogbm4uTW9kdWxlLCBjcml0ZXJpb24sICosIHBhcmFtcywKICAgICAgICAgIHRyYWluX2xvYWRlciwgdmFsaWRfbG9hZGVyLCBpbml0X29wdGltaXplciwgdXNlX2N1ZGEsCiAgICAgICAgICBuX2Vwb2Nocz1Ob25lLCBwYXRpZW5jZT0yLCBtYXhfbHJfY2hhbmdlcz0yKSAtPiBib29sOgogICAgbHIgPSBhcmdzLmxyCiAgICBuX2Vwb2NocyA9IG5fZXBvY2hzIG9yIGFyZ3Mubl9lcG9jaHMKICAgIHBhcmFtcyA9IGxpc3QocGFyYW1zKQogICAgb3B0aW1pemVyID0gaW5pdF9vcHRpbWl6ZXIocGFyYW1zLCBscikKCiAgICBydW5fcm9vdCA9IFBhdGgoYXJncy5ydW5fcm9vdCkKICAgIG1vZGVsX3BhdGggPSBydW5fcm9vdCAvICdtb2RlbC5wdGgnCiAgICBiZXN0X21vZGVsX3BhdGggPSBydW5fcm9vdCAvICdiZXN0LW1vZGVsLnB0aCcKICAgIGlmIG1vZGVsX3BhdGguZXhpc3RzKCk6CiAgICAgICAgc3RhdGUgPSBsb2FkX21vZGVsKG1vZGVsLCBtb2RlbF9wYXRoKQogICAgICAgIGVwb2NoID0gc3RhdGVbJ2Vwb2NoJ10KICAgICAgICBzdGVwID0gc3RhdGVbJ3N0ZXAnXQogICAgICAgIGJlc3RfdmFsaWRfbG9zcyA9IHN0YXRlWydiZXN0X3ZhbGlkX2xvc3MnXQogICAgICAgIGJlc3RfdmFsaWRfcXdrID0gc3RhdGVbJ2Jlc3RfdmFsaWRfcXdrJ10KICAgIGVsc2U6CiAgICAgICAgZXBvY2ggPSAxCiAgICAgICAgc3RlcCA9IDAKICAgICAgICBiZXN0X3ZhbGlkX2xvc3MgPSBmbG9hdCgnaW5mJykKICAgICAgICBiZXN0X3ZhbGlkX3F3ayA9IDAKICAgIGxyX2NoYW5nZXMgPSAwCgogICAgc2F2ZSA9IGxhbWJkYSBlcDogdG9yY2guc2F2ZSh7CiAgICAgICAgJ21vZGVsJzogbW9kZWwuc3RhdGVfZGljdCgpLAogICAgICAgICdlcG9jaCc6IGVwLAogICAgICAgICdzdGVwJzogc3RlcCwKICAgICAgICAnYmVzdF92YWxpZF9sb3NzJzogYmVzdF92YWxpZF9sb3NzLAogICAgICAgICdiZXN0X3ZhbGlkX1FXSyc6IGJlc3RfdmFsaWRfcXdrCiAgICB9LCBzdHIobW9kZWxfcGF0aCkpCgogICAgcmVwb3J0X2VhY2ggPSAxMDAwMAogICAgbG9nID0gcnVuX3Jvb3Quam9pbnBhdGgoJ3RyYWluLmxvZycpLm9wZW4oJ2F0JywgZW5jb2Rpbmc9J3V0ZjgnKQogICAgdmFsaWRfbG9zc2VzID0gW10KICAgIGxyX3Jlc2V0X2Vwb2NoID0gZXBvY2gKICAgIGZvciBlcG9jaCBpbiByYW5nZShlcG9jaCwgbl9lcG9jaHMgKyAxKToKICAgICAgICBtb2RlbC50cmFpbigpCiAgICAgICAgdHEgPSB0cWRtLnRxZG0odG90YWw9KGFyZ3MuZXBvY2hfc2l6ZSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4odHJhaW5fbG9hZGVyKSAqIGFyZ3MuYmF0Y2hfc2l6ZSkpCiAgICAgICAgdHEuc2V0X2Rlc2NyaXB0aW9uKGYnRXBvY2gge2Vwb2NofSwgbHIge2xyfScpCiAgICAgICAgbG9zc2VzID0gW10KICAgICAgICB0bCA9IHRyYWluX2xvYWRlcgogICAgICAgIGlmIGFyZ3MuZXBvY2hfc2l6ZToKICAgICAgICAgICAgdGwgPSBpc2xpY2UodGwsIGFyZ3MuZXBvY2hfc2l6ZSAvLyBhcmdzLmJhdGNoX3NpemUpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBtZWFuX2xvc3MgPSAwCiAgICAgICAgICAgIGZvciBpLCAoaW5wdXRzLCB0YXJnZXRzKSBpbiBlbnVtZXJhdGUodGwpOgogICAgICAgICAgICAgICAgaWYgdXNlX2N1ZGE6CiAgICAgICAgICAgICAgICAgICAgaW5wdXRzLCB0YXJnZXRzID0gaW5wdXRzLmN1ZGEoKSwgdGFyZ2V0cy5jdWRhKCkKICAgICAgICAgICAgICAgIG91dHB1dHMgPSBtb2RlbChpbnB1dHMpCiAgICAgICAgICAgICAgICBsb3NzID0gX3JlZHVjZV9sb3NzKGNyaXRlcmlvbihvdXRwdXRzLCB0YXJnZXRzKSkKICAgICAgICAgICAgICAgIGJhdGNoX3NpemUgPSBpbnB1dHMuc2l6ZSgwKQogICAgICAgICAgICAgICAgKGJhdGNoX3NpemUgKiBsb3NzKS5iYWNrd2FyZCgpCiAgICAgICAgICAgICAgICBpZiAoaSArIDEpICUgYXJncy5zdGVwID09IDA6CiAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVyLnN0ZXAoKQogICAgICAgICAgICAgICAgICAgIG9wdGltaXplci56ZXJvX2dyYWQoKQogICAgICAgICAgICAgICAgICAgIHN0ZXAgKz0gMQogICAgICAgICAgICAgICAgdHEudXBkYXRlKGJhdGNoX3NpemUpCiAgICAgICAgICAgICAgICBsb3NzZXMuYXBwZW5kKGxvc3MuaXRlbSgpKQogICAgICAgICAgICAgICAgbWVhbl9sb3NzID0gbnAubWVhbihsb3NzZXNbLXJlcG9ydF9lYWNoOl0pCiAgICAgICAgICAgICAgICB0cS5zZXRfcG9zdGZpeChsb3NzPWYne21lYW5fbG9zczouM2Z9JykKICAgICAgICAgICAgICAgIGlmIGkgYW5kIGkgJSByZXBvcnRfZWFjaCA9PSAwOgogICAgICAgICAgICAgICAgICAgIHdyaXRlX2V2ZW50KGxvZywgc3RlcCwgbG9zcz1tZWFuX2xvc3MpCiAgICAgICAgICAgIHdyaXRlX2V2ZW50KGxvZywgc3RlcCwgbG9zcz1tZWFuX2xvc3MpCiAgICAgICAgICAgIHRxLmNsb3NlKCkKICAgICAgICAgICAgc2F2ZShlcG9jaCArIDEpCiAgICAgICAgICAgIHZhbGlkX21ldHJpY3MgPSB2YWxpZGF0aW9uKG1vZGVsLCBjcml0ZXJpb24sIHZhbGlkX2xvYWRlciwgdXNlX2N1ZGEpCiAgICAgICAgICAgIHdyaXRlX2V2ZW50KGxvZywgc3RlcCwgKip2YWxpZF9tZXRyaWNzKQogICAgICAgICAgICB2YWxpZF9sb3NzID0gdmFsaWRfbWV0cmljc1sndmFsaWRfbG9zcyddCiAgICAgICAgICAgIHZhbGlkX3F3ayA9IHZhbGlkX21ldHJpY3NbJ3ZhbGlkX3F3ayddCiAgICAgICAgICAgIHZhbGlkX2xvc3Nlcy5hcHBlbmQodmFsaWRfbG9zcykKICAgICAgICAgICAgaWYgdmFsaWRfbG9zcyA8IGJlc3RfdmFsaWRfbG9zczoKICAgICAgICAgICAgICAgIGJlc3RfdmFsaWRfbG9zcyA9IHZhbGlkX2xvc3MKICAgICAgICAgICAgICAgICMgc2h1dGlsLmNvcHkoc3RyKG1vZGVsX3BhdGgpLCBzdHIoYmVzdF9tb2RlbF9wYXRoKSkKICAgICAgICAgICAgaWYgYmVzdF92YWxpZF9xd2sgPCB2YWxpZF9xd2s6CiAgICAgICAgICAgICAgICBiZXN0X3ZhbGlkX3F3ayA9IHZhbGlkX3F3awogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkoc3RyKG1vZGVsX3BhdGgpLCBzdHIoYmVzdF9tb2RlbF9wYXRoKSkKICAgICAgICAgICAgICAgIHByaW50KGYnU2F2ZWQgYmVzdCBtb2RlbCBhdCBFcG9jaCB7ZXBvY2h9LCBiZXN0X3ZhbGlkX3F3ayB7YmVzdF92YWxpZF9xd2t9JykKICAgICAgICAgICAgZWxpZiAocGF0aWVuY2UgYW5kIGVwb2NoIC0gbHJfcmVzZXRfZXBvY2ggPiBwYXRpZW5jZSBhbmQKICAgICAgICAgICAgICAgICAgbWluKHZhbGlkX2xvc3Nlc1stcGF0aWVuY2U6XSkgPiBiZXN0X3ZhbGlkX2xvc3MpOgogICAgICAgICAgICAgICAgIyAicGF0aWVuY2UiIGVwb2NocyB3aXRob3V0IGltcHJvdmVtZW50CiAgICAgICAgICAgICAgICBscl9jaGFuZ2VzICs9IDEKICAgICAgICAgICAgICAgIGlmIGxyX2NoYW5nZXMgPiBtYXhfbHJfY2hhbmdlczoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgbHIgLz0gNQogICAgICAgICAgICAgICAgcHJpbnQoZidsciB1cGRhdGVkIHRvIHtscn0nKQogICAgICAgICAgICAgICAgbHJfcmVzZXRfZXBvY2ggPSBlcG9jaAogICAgICAgICAgICAgICAgb3B0aW1pemVyID0gaW5pdF9vcHRpbWl6ZXIocGFyYW1zLCBscikKICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgIHRxLmNsb3NlKCkKICAgICAgICAgICAgcHJpbnQoJ0N0cmwrQywgc2F2aW5nIHNuYXBzaG90JykKICAgICAgICAgICAgc2F2ZShlcG9jaCkKICAgICAgICAgICAgcHJpbnQoJ2RvbmUuJykKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiB2YWxpZGF0aW9uKAogICAgICAgIG1vZGVsOiBubi5Nb2R1bGUsIGNyaXRlcmlvbiwgdmFsaWRfbG9hZGVyLCB1c2VfY3VkYSwKICAgICAgICApIC0+IERpY3Rbc3RyLCBmbG9hdF06CiAgICBtb2RlbC5ldmFsKCkKICAgIGFsbF9sb3NzZXMsIGFsbF9wcmVkaWN0aW9ucywgYWxsX3RhcmdldHMgPSBbXSwgW10sIFtdCiAgICB3aXRoIHRvcmNoLm5vX2dyYWQoKToKICAgICAgICBmb3IgaW5wdXRzLCB0YXJnZXRzIGluIHZhbGlkX2xvYWRlcjoKICAgICAgICAgICAgYWxsX3RhcmdldHMuYXBwZW5kKHRhcmdldHMubnVtcHkoKS5jb3B5KCkpCiAgICAgICAgICAgIGlmIHVzZV9jdWRhOgogICAgICAgICAgICAgICAgaW5wdXRzLCB0YXJnZXRzID0gaW5wdXRzLmN1ZGEoKSwgdGFyZ2V0cy5jdWRhKCkKICAgICAgICAgICAgb3V0cHV0cyA9IG1vZGVsKGlucHV0cykKICAgICAgICAgICAgbG9zcyA9IGNyaXRlcmlvbihvdXRwdXRzLCB0YXJnZXRzKQogICAgICAgICAgICBhbGxfbG9zc2VzLmFwcGVuZChfcmVkdWNlX2xvc3MobG9zcykuaXRlbSgpKQogICAgICAgICAgICBwcmVkaWN0aW9ucyA9IHRvcmNoLnNpZ21vaWQob3V0cHV0cykKICAgICAgICAgICAgYWxsX3ByZWRpY3Rpb25zLmFwcGVuZChwcmVkaWN0aW9ucy5jcHUoKS5udW1weSgpKQogICAgYWxsX3ByZWRpY3Rpb25zID0gbnAuY29uY2F0ZW5hdGUoYWxsX3ByZWRpY3Rpb25zKQogICAgYWxsX3RhcmdldHMgPSBucC5jb25jYXRlbmF0ZShhbGxfdGFyZ2V0cykKCiAgICBvcHRSID0gT3B0aW1pemVkUm91bmRlcigpCiAgICBvcHRSLmZpdChhbGxfcHJlZGljdGlvbnMsIGFsbF90YXJnZXRzKQogICAgY29lZmZpY2llbnRzID0gb3B0Ui5jb2VmZmljaWVudHMoKQogICAgeV9wcmVkID0gb3B0Ui5wcmVkaWN0KGFsbF9wcmVkaWN0aW9ucywgY29lZmZpY2llbnRzKQoKICAgIGRlZiBnZXRfc2NvcmUoeV9wcmVkKToKICAgICAgICB3aXRoIHdhcm5pbmdzLmNhdGNoX3dhcm5pbmdzKCk6CiAgICAgICAgICAgIHdhcm5pbmdzLnNpbXBsZWZpbHRlcignaWdub3JlJywgY2F0ZWdvcnk9VW5kZWZpbmVkTWV0cmljV2FybmluZykKICAgICAgICAgICAgcmV0dXJuIHF1YWRyYXRpY193ZWlnaHRlZF9rYXBwYShhbGxfdGFyZ2V0cywgeV9wcmVkKQoKICAgIG1ldHJpY3MgPSB7fQogICAgbWV0cmljc1sndmFsaWRfbG9zcyddID0gbnAubWVhbihhbGxfbG9zc2VzKQogICAgbWV0cmljc1sndmFsaWRfcXdrJ10gPSBnZXRfc2NvcmUoeV9wcmVkKQoKICAgIHJldHVybiBtZXRyaWNzCgoKZGVmIF9yZWR1Y2VfbG9zcyhsb3NzKToKICAgIHJldHVybiBsb3NzLnN1bSgpIC8gbG9zcy5zaGFwZVswXQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCkK',
                    'aptos/__init__.py': 'aW1wb3J0IGN2MgpjdjIuc2V0TnVtVGhyZWFkcygwKQo=',
                    'setup.py': 'ZnJvbSBzZXR1cHRvb2xzIGltcG9ydCBzZXR1cAoKc2V0dXAoCiAgICBuYW1lPSdhcHRvcycsCiAgICBwYWNrYWdlcz1bJ2FwdG9zJ10sCikK'
                    }


for path, encoded in file_data.items():
    print(path)
    path = Path(path)
    path.parent.mkdir(exist_ok=True)
    path.write_bytes(base64.b64decode(encoded))


def run(command):
    os.system('export PYTHONPATH=${PYTHONPATH}:/kaggle/working && ' + command)


## resnet18
os.makedirs('../input/resnet18')
shutil.copy('../input/pytorch-pretrained-image-models/resnet18.pth', '../input/resnet18/')

## densenet121
#os.makedirs('../input/densenet121')
#shutil.copy('../input/pytorch-pretrained-image-models/densenet121.pth', '../input/densenet121/')

## densenet169 xxx
#os.makedirs('../input/densenet169')
#shutil.copy('../input/pytorch-pretrained-models/densenet169-b2777c0a.pth', '../input/densenet169/densenet169.pth')

## densenet201
#os.makedirs('../input/densenet201')
#shutil.copy('../input/pytorch-pretrained-image-models/densenet201.pth', '../input/densenet201/')

## densenet161 xxx
#os.makedirs('../input/densenet161')
#shutil.copy('../input/pytorch-densenet-pretrained/densenet161-8d451a50.pth', '../input/densenet161/densenet161.pth')

## inception v3
#os.makedirs('../input/inception_v3')
#shutil.copy('../input/pytorch-pretrained-models/inception_v3_google-1a9a5a14.pth', '../input/inception_v3/inception_v3.pth')

## se_resnet50
#os.makedirs('../input/se_resnet50')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnet50-ce0d4300.pth', '../input/se_resnet50/se_resnet50.pth')

## se_resnet101
#os.makedirs('../input/se_resnet101')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnet101-7e38fcc6.pth', '../input/se_resnet101/se_resnet101.pth')

## se_resnet152
#os.makedirs('../input/se_resnet152')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnet152-d17c99b7.pth', '../input/se_resnet152/se_resnet152.pth')

## se_resnext50_32x4d
#os.makedirs('../input/se_resnext50_32x4d')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnext50_32x4d-a260b3a4.pth', '../input/se_resnext50_32x4d/se_resnext50_32x4d.pth')

## se_resnext101_32x4d
#os.makedirs('../input/se_resnext101_32x4d')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnext101_32x4d-3b2fe3d8.pth', '../input/se_resnext101_32x4d/se_resnext101_32x4d.pth')


print(os.listdir('/kaggle/working/'))
run('python setup.py develop --install-dir /kaggle/working')
run('python -m aptos.make_folds --n-folds 5 --seed 42')
run('python -m aptos.main train model_1 --n-epochs 15 --model se_resnext50_32x4d --batch-size 32')
#print(os.listdir('/kaggle/working/'))
#run('python -m imet.main predict_test model_1 --model se_resnext101_32x4d --batch-size 32')
#run('python -m imet.make_submission model_1/test.h5 submission.csv --threshold 0.10')
